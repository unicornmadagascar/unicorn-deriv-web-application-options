<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ü¶Ñ World Unicorn ‚Äî Deriv Live Ticks</title>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/ml5@0.12.2/dist/ml5.min.js"></script>
  <script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script defer src="app.js"></script>

  <style>
    :root {
      --panel-height: 800px;
      --gap: 7px;
      --bg: #0f1724;
      --card: #ffffff;
      --muted: #94a3b8;
      /* ML Table */
      --bg-main: #ffffff;
      --bg-sub: #f8f9fc;
      --border-color: #eef1f6;
      --text-dark: #2d3436;
      --text-gray: #636e72;
      --text-light: #b2bec3;
      --brand-purple: #89027e;
      /* Votre couleur de probabilit√© */
      --brand-blue: #4834d4;
      /* Couleur pour le prix */
      --success-green: #00b894;
      --danger-red: #d63031;
      /* Account Management */
      --primary: #2563eb;
      --success: #10b981;
      --danger: #ef4444;
      --bg-card: #ffffff;
      --bg-app: #f8fafc;
      --text-main: #0f172a;
      --text-muted: #64748b;
      --border: #e2e8f0;
      /* Contract Opened */
      --primary-hover: #1d4ed8;
      --danger-hover: #dc2626;
      --bg-secondary: #f1f5f9;
      /* Cashier */
      --primary-color: #2563eb;
      --text-dark: #1e293b;
      --text-light: #64748b;
      --border-color: #e2e8f0;
      /* POPUP Symbols */
      --bg-white: #ffffff;
      --border-light: #e0e3eb;
      --text-dark: #131722;
      --text-muted: #6a6d78;
      --accent-blue: #2962ff;
      --hover-bg: #f2f5ff;
    }

    /* .container {
      width: 100%;
      margin-top: 4px;
      margin-left: 14px;
      margin-right: 30px;
      margin-top: 3px;
      padding-top: 2px;
      box-sizing: border-box    
    } */

    h1 {
      font-size: 18px;
      margin-top: 7px;
      color: #4d4747
    }

    /* --- Global Panel Styling --- */
    #panel {
      background: #ffffff;
      /* Fond blanc pur */
      color: #333333;
      /* Texte gris fonc√© pour le confort visuel */
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      /* Ombre plus douce */
      font-family: 'Inter', sans-serif;
      border: 1px solid #e0e3eb;
    }

    #panel h1 {
      color: #1e222d;
      border-left: 4px solid #2563eb;
      /* Bleu vif pour le contraste */
    }

    /* Barre d'outils plus claire */
    .toolbar {
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      /* Emp√™che le passage √† la ligne */
      align-items: center;
      /* Aligne verticalement au centre */
      gap: 10px;
      background: #f8f9fc;
      padding: 10px 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #eef0f7;
      overflow-x: auto;
      /* Ajoute un scroll horizontal si l'√©cran est trop petit au lieu de casser */
    }

    .toolbar input,
    .toolbar select {
      background: #ffffff;
      border: 1px solid #d1d4dc;
      color: #333333;
    }

    /* --- Unifier la hauteur des inputs, select et boutons --- */
    .toolbar input,
    .toolbar select,
    .toolbar button,
    #fetchCalendar,
    #refresh {
      height: 38px;
      /* Hauteur standard moderne */
      box-sizing: border-box;
      font-size: 0.9rem;
    }

    .toolbar input:focus,
    .toolbar select:focus {
      border-color: #2563eb;
      background: #ffffff;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .toolbar label {
      white-space: nowrap;
      /* Emp√™che le texte des labels de se couper */
      font-weight: 500;
      color: #64748b;
    }

    /* --- Ajustements sp√©cifiques des champs --- */
    .toolbar input[type="text"],
    .toolbar input[type="date"],
    .toolbar select {
      background: #ffffff;
      border: 1px solid #d1d4dc;
      color: #333333;
      padding: 0 10px;
      border-radius: 6px;
      outline: none;
      min-width: 120px;
      /* √âvite que les champs ne deviennent trop petits */
    }

    /* Largeur sp√©cifique pour la recherche */
    #search {
      flex: 2;
      /* Permet au champ de recherche de prendre l'espace disponible */
      min-width: 180px;
    }

    /* --- Boutons rectifi√©s --- */
    #fetchCalendar,
    #refresh {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0 15px;
      margin: 0;
      white-space: nowrap;
      border: none;
      cursor: pointer;
      border-radius: 6px;
      font-weight: 600;
    }

    #fetchCalendar {
      background: #2563eb;
      color: white;
    }

    #refresh {
      background: #374151;
      color: white;
    }

    #fetchCalendar:hover {
      opacity: 0.9;
    }

    #refresh:hover {
      background: #4b5563;
    }

    #fetchCalendar:active {
      transform: scale(0.95);
    }

    /* --- Table Design --- */
    .table-wrap {
      overflow-x: auto;
      border-radius: 8px;
      border: 1px solid #363a45;
    }

    #CalendarList table {
      width: 100%;
      border-collapse: collapse;
      text-align: left;
      font-size: 0.9rem;
    }

    #CalendarList th {
      background: #2a2e39;
      color: #848e9c;
      font-weight: 500;
      padding: 12px 15px;
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.5px;
    }

    #CalendarList td {
      padding: 14px 15px;
      border-bottom: 1px solid #2a2e39;
    }

    #CalendarList tr:hover {
      background: rgba(59, 130, 246, 0.05);
    }

    /* --- Dynamic Impact Badges --- */
    /* Ces classes devront √™tre ajout√©es par votre JS lors de la g√©n√©ration des lignes */
    .impact-high {
      color: #ff4d4d;
      background: rgba(255, 77, 77, 0.1);
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: bold;
    }

    .impact-medium {
      color: #ffa500;
      background: rgba(255, 165, 0, 0.1);
      padding: 4px 8px;
      border-radius: 4px;
    }

    .impact-low {
      color: #00c805;
      background: rgba(0, 200, 5, 0.1);
      padding: 4px 8px;
      border-radius: 4px;
    }

    /* Status text */
    #status {
      margin-left: auto;
      /* Pousse le statut tout √† fait √† droite */
      padding: 4px 12px;
      background: #e2e8f0;
      /* Gris clair pour mode blanc */
      color: #475569;
      border-radius: 20px;
      font-size: 0.8rem;
      font-style: normal;
      font-weight: 500;
      white-space: nowrap;
    }

    .table-wrap {
      overflow-x: auto;
      border-radius: 8px;
      border: 1px solid #e0e3eb;
      /* Bordure claire */
    }

    /* Style g√©n√©ral de la table */
    .modal-calendar {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      z-index: 1000;
      /* Toujours au-dessus du chart */
      overflow: hidden;
    }

    /* En-t√™te de table */
    .modern-calendar th {
      background: #f1f3f7;
      color: #6a6d78;
      border-bottom: 2px solid #e0e3eb;
    }

    .modern-calendar th.sortable {
      cursor: pointer;
      transition: color 0.2s;
    }

    .modern-calendar th.sortable:hover {
      background: #e8ebf2;
      color: #2563eb;
    }

    .sort-icon {
      font-size: 10px;
      opacity: 0.3;
      margin-left: 4px;
    }

    .active-sort {
      color: #3b82f6 !important;
    }

    /* √âtat vide moderne */
    .empty-state td {
      padding: 60px 0 !important;
      background: rgba(0, 0, 0, 0.05);
    }

    .no-data-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      opacity: 0.5;
    }

    .no-data-content .icon {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    #CalendarList table {
      width: 100%;
      border-collapse: collapse;
      background: #ffffff;
    }

    #CalendarList th {
      background: #f8f9fc;
      /* En-t√™te l√©g√®rement gris√© */
      color: #475569;
      font-weight: 600;
      border-bottom: 2px solid #e2e8f0;
      padding: 12px 15px;
    }

    #CalendarList td {
      padding: 12px 15px;
      border-bottom: 1px solid #f1f5f9;
      color: #334155;
    }

    #calendarBody tr:hover {
      background: #fdfdfd;
      /* Tr√®s l√©ger changement au survol */
    }

    /* Ligne s√©lectionn√©e (si vous utilisez cette fonction) */
    .selected-row {
      background: #eef4ff !important;
      border-left: 3px solid #2563eb;
    }

    /* Style pour les lignes dont la checkbox est coch√©e */
    .selected-row-active {
      background-color: rgba(59, 130, 246, 0.05) !important;
      /* Bleu tr√®s l√©ger */
      border-left: 4px solid #3b82f6 !important;
      /* Rappel de la couleur du marqueur */
    }

    /* Alignements sp√©cifiques */
    .text-center {
      text-align: center;
    }

    .col-check {
      width: 40px;
      text-align: center;
    }

    .modern-calendar th.active-sort .sort-icon {
      color: #3b82f6;
      font-weight: bold;
    }

    ¬≤

    /* Conteneur de base du badge */
    .impact-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 14px;
      border-radius: 50px;
      font-size: 11px;
      font-weight: 800;
      color: white !important;
      min-width: 120px;
    }

    .impact-badge::before {
      content: '';
      width: 7px;
      height: 7px;
      background: white;
      border-radius: 50%;
    }

    /* Vos couleurs pleines */
    .imp-5,
    .imp-4 {
      background: #ef4444 !important;
    }

    .imp-3 {
      background: #f59e0b !important;
    }

    .imp-2,
    .imp-1 {
      background: #3b82f6 !important;
    }

    /* Animation de clignotement pour la table */
    @keyframes blink {
      0% {
        background-color: transparent;
      }

      50% {
        background-color: rgba(37, 99, 235, 0.2);
      }

      100% {
        background-color: transparent;
      }
    }

    /* Animation de flash bleu doux */
    @keyframes flashBlue {
      0% {
        background-color: rgba(37, 99, 235, 0);
      }

      50% {
        background-color: rgba(37, 99, 235, 0.25);
      }

      100% {
        background-color: rgba(37, 99, 235, 0.1);
      }
    }

    .btn-export {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background-color: #ffffff;
      color: #374151;
      border: 1px solid #e5e7eb;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .btn-export:hover {
      background-color: #f9fafb;
      border-color: #d1d5db;
      transform: translateY(-1px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .btn-export:active {
      transform: translateY(0);
    }


    /* --------------- BODY --------------- */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      height: 105vh;
      display: flex;
      flex-direction: column;
      background: #f8f9fa;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 16px;
      background: #fff;
      border-bottom: 1px solid #e6e6e6;
    }

    #symbolList {
      display: flex;
      gap: 10px;
      overflow-x: auto;
    }

    .symbol-item {
      padding: 6px 12px;
      border-radius: 20px;
      background: #eee;
      cursor: pointer;
      font-weight: 600;
      transition: 0.18s;
    }

    .symbol-item:hover {
      background: #007bff;
      color: #fff;
    }

    #container__ {
      position: relative;
      flex: 0;
      flex-direction: column;
      display: flex;
    }

    /* chart area */
    #chartArea {
      position: relative;
      /* R√©f√©rentiel pour l'absolute */
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    /* Le graphique de fond */
    #chartInner {
      flex: 0;
      min-height: 750px;
      background: #fff;
      margin: 12px;
      border-radius: 8px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
      overflow: hidden;
      position: relative;
    }

    /* Le Canvas de Trendline */
    #Trendoverlay__ {
      position: absolute;
      /* Sort du flux flex */
      top: 0;
      left: 0;
      /* On utilise calc pour d√©duire les marges de 12px du parent */
      width: calc(100% - 24px);
      height: calc(100% - 24px);
      margin: 12px;
      /* Doit √™tre identique √† #chartInner */

      z-index: 1000;
      cursor: crosshair;
      pointer-events: all;
      /* Permet de dessiner */
      background: transparent !important;
      /* Indispensable pour voir le chart derri√®re */
      pointer-events: none;
      /* Indispensable pour capter le mousedown */
    }

    /* Style du Menu Contextuel */
    #context-menu {
      display: none;
      position: absolute;
      z-index: 2000;
      background: #1f2937;
      border: 1px solid #374151;
      border-radius: 4px;
      padding: 4px 0;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      color: white;
      cursor: pointer;
      min-width: 120px;
    }

    .menu-item {
      padding: 8px 12px;
      font-size: 14px;
    }

    .menu-item:hover {
      background: #3b82f6;
    }

    /* Style du badge PnL */
    #pnl-container {
      position: absolute;
      top: 25px;
      /* Ajust√© pour √™tre √† l'int√©rieur du margin de 12px */
      right: 35px;
      /* Ajust√© pour ne pas couvrir l'√©chelle des prix */
      z-index: 9999;
      font-family: sans-serif;
      font-weight: bold;
      background: rgba(0, 0, 0, 0.75);
      /* Fond sombre pour contraste sur graphique blanc */
      padding: 8px 15px;
      border-radius: 6px;
      color: #fff;
      pointer-events: none;
      /* Permet de cliquer sur le graphique √† travers le texte */
      display: flex;
      align-items: center;
      gap: 5px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    #total-pnl {
      font-size: 1.2em;
    }

    #pnl-arrow {
      font-size: 1.1em;
      transition: all 0.2s ease;
    }

    .pnl-label {
      font-size: 0.75em;
      opacity: 0.8;
      margin-right: 5px;
    }

    /* Style du Tooltip (d√©j√† fourni mais rappel√© pour coh√©rence) */
    #chart-tooltip {
      position: absolute;
      display: none;
      padding: 12px;
      background-color: rgba(255, 255, 255, 0.98);
      color: #1e222d;
      border: 1px solid #d1d4dc;
      border-radius: 8px;
      z-index: 1000;
      pointer-events: none;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      font-family: Arial, sans-serif;
      min-width: 180px;
    }

    /* Nouveau nom pour la mise en surbrillance */
    .active-event-sync {
      background-color: #f2f5ff !important;
      /* Bleu tr√®s p√¢le */
      border-left: 4px solid #2962ff;
      /* Barre bleue distinctive sur le c√¥t√© */
      transition: background-color 0.2s ease;
    }

    .calendar-row {
      border-bottom: 1px solid #f1f3f6;
      transition: background 0.2s;
    }

    .calendar-row:hover {
      background-color: #f8f9fb;
    }

    /* top controls */
    #controls {
      padding: 8px 16px;
      background: #fff;
      border-bottom: 1px solid #eee;
      display: flex;
      gap: 12px;
      align-items: center;
    }

    #connectBtn {
      /* Couleur Bleu TradingView */
      background: #2962ff;
      color: #ffffff;

      /* Dimensions et Espacement */
      padding: 12px 15px;
      border-radius: 8px;
      /* Coins l√©g√®rement plus arrondis */

      /* Typographie */
      font-weight: 600;
      font-size: 14px;
      border: none;

      /* Interaction */
      cursor: pointer;
      transition: background 0.2s ease;
      /* Transition douce pour le hover */
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    #connectBtn:hover {
      /* Un bleu l√©g√®rement plus sombre au survol */
      background: #1e53e5;
    }

    #connectBtn:active {
      /* Effet de clic */
      transform: scale(0.98);
    }

    /* --- Control Panel --- */
    #controlFormPanel {
      display: none;
      position: relative;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      padding: 20px;
      margin-top: 10px;
      width: 100%;
      box-sizing: border-box;
      transition: all 0.25s ease-in-out;
    }

    #controlFormPanel div {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    #controlFormPanel button {
      height: 42px;
      padding: 0 16px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    }

    #controlFormPanel button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.12);
    }

    #STOP {
      background-color: white;
      color: #4d4747;
    }

    #START {
      background-color: white;
      color: #4d4747;
    }

    #openPopupBtn__ {
      background-color: white;
      color: #4d4747;
    }

    #openCashierBtn {
      background-color: white;
      color: #4d4747;
    }

    #openPopup {
      background-color: white;
      color: #4d4747;
    }

    #buyBtn {
      background-color: white;
      color: #4d4747;
    }

    #sellBtn {
      background-color: white;
      color: #4d4747;
    }

    #reverseBtn {
      background-color: white;
      color: #4d4747;
    }

    #closeWinning {
      background-color: white;
      color: #4d4747;
    }

    #closeLosing {
      background-color: white;
      color: #4d4747;
    }

    #closeAll {
      background-color: white;
      color: #4d4747;
    }

    #DatasettingPopup {
      background-color: white;
      color: #4d4747;
    }

    /* Overlay sombre */
    /* Overlay flout√© pour focaliser sur le popup */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(4px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      visibility: hidden;
      /* √Ä changer en 'visible' via JS */
      opacity: 0;
      transition: all 0.3s ease;
    }

    .popup-overlay.active {
      visibility: visible;
      opacity: 1;
    }

    /* La Bo√Æte Popup */
    .popup-box {
      background: #fdfdfd;
      width: 380px;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      font-family: 'Segoe UI', sans-serif;
    }

    .popup-box h2 {
      margin-top: 0;
      font-size: 1.5rem;
      color: #333;
      text-align: center;
      margin-bottom: 25px;
    }

    /* Grille des champs */
    .popup-content {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .input-row {
      display: flex;
      gap: 10px;
    }

    .input-field {
      flex: 1;
    }

    /* Style des Inputs & Select */
    .popup-content input,
    .popup-content select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      background: #fff;
      font-size: 0.95rem;
      color: #444;
      outline: none;
      transition: border-color 0.2s;
      box-sizing: border-box;
    }

    .popup-content input:focus {
      border-color: #2962FF;
    }

    /* Couleurs sp√©cifiques pour TP/SL */
    .tp input {
      border-left: 4px solid #00ffa3;
    }

    .sl input {
      border-left: 4px solid #ff3d60;
    }

    /* BOUTONS BLANCS AVEC DOUCE OMBRE */
    .popup-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
      gap: 15px;
    }

    .popup-buttons button {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      background: #ffffff;
      /* Couleur blanche demand√©e */
      color: #444;
      /* Douce ombre port√©e */
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
    }

    .popup-buttons button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);
      background: #fcfcfc;
    }

    #savePopupBtn {
      color: #2962FF;
      /* Texte bleu pour le bouton d'action */
      border: 1px solid #f0f0f0;
    }

    #closePopupBtn {
      color: #888;
    }

    /* Animation popup */
    @keyframes popupShow {
      from {
        opacity: 0;
        transform: scale(0.78);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    #controlPanelToggle {
      margin-top: 10px;
      padding: 8px 16px;
      border-radius: 8px;
      background: white;
      color: #4d4747;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    #controlPanelToggle:hover {
      background: white;
      transform: translateY(-2px);
    }

    #controlFormPanel {
      display: none;
      opacity: 0;
      transform: translateY(40px);
      transition: all 0.35s ease;
      flex-direction: column;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      padding: 20px;
      margin-top: 12px;
    }

    #controlFormPanel.active {
      opacity: 1;
      transform: translateY(0);
    }

    /* üìä Panneau des contrats ouverts */
    /* --- 1. CONTENEURS PRINCIPAUX --- */
    #contractsPanelContainer {
      background: #ffffff;
      border-radius: 16px;
      padding: 20px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 20px;
    }

    /* Le panneau qui contient tout */
    #contractsPanel {
      display: none;
      flex-direction: column;
      /* Force la table √† aller SOUS les cercles */
      width: 100%;
      min-height: 200px;
      /* Donne une hauteur minimum pour le test */
      background: white;
      padding: 20px;
    }

    /* Quand on active le panneau */
    #contractsPanel.active {
      display: flex;
      opacity: 1;
      animation: fadeInPanel 0.3s ease-out;
    }

    /* Ajustement pour que la table ne d√©borde pas */
    #contractsPanel .table-responsive {
      width: 100%;
      overflow-x: auto;
      /* Permet le scroll si la table est large */
    }

    /* Fixer l'en-t√™te pendant le scroll vertical */
    #contractsPanel .trade-table thead th {
      position: sticky;
      top: 0;
      background: #ffffff;
      /* Couleur de fond pour ne pas voir les lignes passer dessous */
      z-index: 10;
      border-bottom: 2px solid #f1f5f9;
    }

    /* Style de base pour les lignes */
    #contractsPanel #autoTradeBody tr {
      transition: background-color 0.2s ease;
      border-bottom: 1px solid #f1f5f9;
    }

    /* Effet au survol (Hover) pour aider la lecture */
    #contractsPanel #autoTradeBody tr:hover {
      background-color: #f8fafc;
      /* Gris tr√®s l√©ger */
    }

    /* Style pour la ligne quand elle est s√©lectionn√©e (via JS) */
    #contractsPanel #autoTradeBody tr.selected-row {
      background-color: #f0f7ff;
      /* Bleu tr√®s p√¢le */
    }

    /* On change la couleur de la bordure gauche pour la ligne s√©lectionn√©e */
    #contractsPanel #autoTradeBody tr.selected-row td:first-child {
      border-left: 3px solid #3b82f6;
      /* Petite barre bleue √† gauche */
    }

    /* Zone de la table */
    #contractsPanel #autoHistoryList {
      display: block !important;
      /* Force l'affichage */
      width: 100%;
      margin-top: 20px;
      clear: both;
      /* S√©curit√© si vous utilisez des floats */
    }

    @keyframes fadeInPanel {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* --- 2. BOUTON DE CONTR√îLE PRINCIPAL --- */
    #contractsPanelToggle {
      background: #3b82f6;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    #contractsPanelToggle:hover {
      background: #2563eb;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    #contractsPanelToggle.btn-active {
      background: #64748b;
      /* Gris quand ouvert pour contraste */
    }

    /* --- 3. STRUCTURE DE LA TABLE (ISOL√âE) --- */
    #contractsPanel .table-wrapper {
      background: #ffffff;
      padding: 10px;
      width: 100%;
      border-radius: 8px;
      max-height: 55vh;
      /* üî• */
      overflow-y: auto;
    }

    #contractsPanel .trade-table {
      width: 100%;
      min-width: 900px;
      border-collapse: separate;
      border-spacing: 0 8px;
      table-layout: auto;
    }

    #contractsPanel .trade-table th {
      color: #94a3b8;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 12px;
      border-bottom: 2px solid #f1f5f9;
      text-align: left;
      white-space: nowrap;
    }

    #contractsPanel .trade-table tbody tr {
      background: #ffffff;
      transition: all 0.2s ease;
    }

    #contractsPanel .trade-table tbody tr:hover {
      transform: translateX(5px);
      background: #f8fafc;
    }

    #contractsPanel .trade-table td {
      padding: 14px 12px;
      border-top: 1px solid #f1f5f9;
      border-bottom: 1px solid #f1f5f9;
      font-size: 0.85rem;
      white-space: nowrap;
      color: #1e293b;
    }

    /* Arrondis sp√©cifiques √† cette table */
    #contractsPanel .trade-table td:first-child {
      border-left: 1px solid #f1f5f9;
      border-radius: 10px 0 0 10px;
    }

    #contractsPanel .trade-table td:last-child {
      border-right: 1px solid #f1f5f9;
      border-radius: 0 10px 10px 0;
    }

    /* --- 4. BOUTONS D'ACTION DANS LA TABLE --- */
    #contractsPanel .table-wrapper #exportCSV {
      background: #f0f7ff;
      color: #2563eb;
      border: 1px solid #dbeafe;
      padding: 8px 16px;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    #contractsPanel .table-wrapper #exportCSV:hover {
      background: #2563eb;
      color: white;
      transform: translateY(-2px);
    }

    /* Style du bouton Panic */
    #contractsPanel .panic-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background-color: #ffffff;
      /* Rouge Alerte */
      color: #f00606;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 800;
      /* Texte bien gras */
      letter-spacing: 0.5px;
      cursor: pointer;
      transition: all 0.1s ease;
      box-shadow: 0 4px 0px #b91c1c;
      /* Ombre fonc√©e pour l'effet 3D */
      margin-left: 10px;
    }

    /* Effet au survol (Hover) */
    #contractsPanel .panic-btn:hover {
      background-color: #ffffff;
      transform: translateY(1px);
      box-shadow: 0 3px 0px #b91c1c;
    }

    /* Effet au clic (Active) - Le bouton s'enfonce */
    #contractsPanel .panic-btn:active {
      transform: translateY(4px);
      box-shadow: 0 0px 0px #b91c1c;
      background-color: #ffffff;
    }

    /* √âtat d√©sactiv√© (quand la fermeture est en cours) */
    #contractsPanel .panic-btn:disabled {
      background-color: #cbd5e1;
      color: #64748b;
      box-shadow: none;
      cursor: not-allowed;
      transform: none;
    }

    /* Animation de l'ic√¥ne üö® */
    #contractsPanel .panic-btn:hover span {
      animation: blink 0.5s infinite alternate;
    }

    @keyframes blink {
      from {
        opacity: 1;
        transform: scale(1);
      }

      to {
        opacity: 0.7;
        transform: scale(1.2);
      }
    }

    /* --- 5. INDICATEURS DE PROFIT & STATUT --- */
    #contractsPanel .profit-positive {
      color: #10b981;
      font-weight: 800;
      animation: pulse-green 2s infinite;
    }

    #contractsPanel .profit-negative {
      color: #ef4444;
      font-weight: 800;
    }

    #contractsPanel .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-left: 8px;
    }

    #contractsPanel .status-online {
      background: #10b981;
      box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
      animation: pulse-status 2s infinite;
    }

    #contractsPanel .status-offline {
      background: #cbd5e1;
    }

    /* --- 6. FOOTER STATISTIQUES --- */
    #contractsPanel .table-footer-stats {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f8fafc;
      padding: 15px 20px;
      border-radius: 14px;
      margin-top: 20px;
      border: 1px solid #e2e8f0;
      flex-wrap: wrap;
      gap: 15px;
    }

    #contractsPanel .stats-item label {
      font-size: 0.7rem;
      font-weight: 700;
      color: #64748b;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    #totalFloatingProfit,
    #totalOpenContracts {
      font-size: 1.2rem;
      font-weight: 800;
      font-variant-numeric: tabular-nums;
    }

    #contractsPanel .rowSelect {
      cursor: pointer;
      transform: scale(1.2);
    }

    /* Alignement des cercles (Donuts) */
    #contractsPanel .donuts-wrapper {
      display: flex;
      justify-content: space-around;
      /* Met les deux cercles c√¥te √† c√¥te */
      align-items: center;
      flex-wrap: wrap;
      /* Permet de passer √† la ligne sur mobile */
      width: 100%;
    }

    #contractsPanel .donut-card {
      text-align: center;
      width: 120px;
    }

    #contractsPanel .donut-svg {
      width: 100px;
      height: 100px;
    }

    #contractsPanel .donut-bg {
      fill: none;
      stroke: #f1f5f9;
      /* Couleur du cercle de fond (gris clair) */
      stroke-width: 3;
    }

    #contractsPanel .donut-path {
      fill: none;
      stroke-width: 3;
      stroke-linecap: round;
      transition: stroke-dasharray 0.5s ease;
    }

    #contractsPanel .donut-path.profit {
      stroke: #10b981;
    }

    #contractsPanel .donut-path.loss {
      stroke: #ef4444;
    }

    #contractsPanel .donut-text {
      font-size: 8px;
      font-weight: bold;
      text-anchor: middle;
      fill: #1e293b;
    }

    #contractsPanel .donut-info {
      text-align: center;
      font-size: 14px;
      font-weight: 600;
      margin-top: 5px;
    }

    #contractsPanel .row-selected {
      background-color: #f0f7ff !important;
      /* Bleu tr√®s l√©ger */
    }

    #contractsPanel #selectAll {
      cursor: pointer;
      transform: scale(1.2);
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* --- 7. ANIMATIONS --- */
    @keyframes pulse-green {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.7;
      }
    }

    @keyframes pulse-status {
      0% {
        transform: scale(1);
        opacity: 1;
      }

      50% {
        transform: scale(1.2);
        opacity: 0.7;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* Animation fluide du trac√© du cercle */
    #contractsPanel .donut-path {
      transition: stroke-dasharray 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Optionnel : couleur diff√©rente si le pourcentage est √† 100% (Win Rate parfait) */
    #contractsPanel #panel-circle-profit-path[stroke-dasharray^="100"] {
      filter: drop-shadow(0 0 3px #10b981);
    }

    /* Petit effet de transition pour que le chiffre ne "saute" pas */
    #contractsPanel #totalFloatingProfit {
      transition: color 0.3s ease;
      font-variant-numeric: tabular-nums;
      /* Garde les chiffres align√©s */
    }

    /* Classes de couleurs pour la table */
    #contractsPanel .text-success {
      color: #10b981;
    }

    #contractsPanel .text-danger {
      color: #ef4444;
    }

    #contractsPanel .badge {
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.7rem;
      font-weight: bold;
      text-transform: uppercase;
    }

    #contractsPanel .total-positive {
      color: #10b981;
      font-weight: bold;
    }

    #contractsPanel .total-negative {
      color: #ef4444;
      font-weight: bold;
    }

    #contractsPanel .total-neutral {
      color: #64748b;
      font-weight: bold;
    }

    #contractsPanel .type-buy {
      background: rgba(16, 185, 129, 0.1);
      color: #10b981;
    }

    #contractsPanel .type-sell {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }

    /* Bouton de fermeture sur chaque ligne */
    #contractsPanel .btn-close-single {
      background: none;
      border: none;
      color: #94a3b8;
      cursor: pointer;
      font-size: 1rem;
      transition: color 0.2s;
    }

    #contractsPanel .btn-close-single:hover {
      color: #ef4444;
    }

    #contractsPanel .action-close {
      background: #f1f5f9;
      border: none;
      color: #64748b;
      width: 28px;
      height: 28px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #contractsPanel .action-close:hover {
      background: #fee2e2;
      color: #ef4444;
      transform: scale(1.1);
    }

    /* Style du bouton Delete Selected */
    #contractsPanel .btn-delete-light {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background-color: #ffffff;
      color: #ef4444;
      /* Rouge corail */
      border: 1.5px solid #fee2e2;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    /* Effet au survol (Hover) */
    #contractsPanel .btn-delete-light:hover {
      background-color: #fef2f2;
      border-color: #ef4444;
      color: #dc2626;
      transform: translateY(-1px);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    /* Effet au clic (Active) */
    #contractsPanel .btn-delete-light:active {
      transform: translateY(0);
      background-color: #fee2e2;
    }

    /* Style si le bouton est d√©sactiv√© */
    #contractsPanel .btn-delete-light:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background-color: #f1f5f9;
      border-color: #e2e8f0;
      color: #94a3b8;
    }

    /* Animation de l'ic√¥ne poubelle au survol */
    #contractsPanel .btn-delete-light:hover i,
    .btn-delete-light:hover span {
      transform: scale(1.1);
    }

    #contractsPanel .stats-item {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    #contractsPanel .stats-item label {
      font-size: 12px;
      color: #64748b;
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 4px;
    }

    #contractsPanel .stats-item span {
      font-size: 1.2rem;
      font-weight: 800;
      font-family: 'Monaco', monospace;
    }

    /* Optionnel : mettre les valeurs en couleur */
    #contractsPanel #panel-profitvalue {
      color: #10b981;
    }

    #contractsPanel #panel-lossvalue {
      color: #ef4444;
    }

    /* --- ACCOUNT MANAGEMENT CONTAINER STYLES --- */
    #tradeEvaluationContainer {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 24px;
      font-family: 'Inter', system-ui, sans-serif;
      border: 1px solid var(--border);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.03);
    }

    /* --- TOGGLE BUTTON --- */
    #tradeEvalToggle {
      background: var(--bg-app);
      border: 1px solid var(--border);
      padding: 12px 20px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    #tradeEvalToggle:hover {
      background: #fff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    /* --- SUMMARY CARD --- */
    #tradeSummary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 24px;
      margin-top: 24px;
      padding: 24px;
      background: var(--bg-app);
      border-radius: 16px;
    }

    .trade-info label,
    .date-group label {
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--text-muted);
      text-transform: uppercase;
      margin-bottom: 8px;
      display: block;
    }

    #balanceValue,
    #accountHolder {
      font-size: 1.4rem;
      font-weight: 800;
      color: var(--text-main);
    }

    .account-actions {
      display: flex;
      gap: 8px;
    }

    #accountSelect,
    input[type="date"] {
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 0.9rem;
    }

    /* --- CIRCULAR CHARTS --- */
    #tradeCharts {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }

    .circle-chart {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      text-align: center;
      transition: transform 0.3s;
    }

    .circle-chart:hover {
      transform: translateY(-5px);
    }

    .chart-container {
      position: relative;
      width: 90px;
      height: 90px;
      margin: 0 auto 15px;
    }

    .circular-chart {
      display: block;
      margin: 0 auto;
    }

    .circle-bg {
      fill: none;
      stroke: #f1f5f9;
      stroke-width: 3;
    }

    .circle {
      fill: none;
      stroke-width: 3;
      stroke-linecap: round;
      transition: stroke-dasharray 0.8s ease;
    }

    .red .circle {
      stroke: var(--danger);
    }

    .blue .circle {
      stroke: var(--primary);
    }

    .mix .circle {
      stroke: var(--success);
    }

    .inner-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .inner-content span {
      font-size: 1.1rem;
      font-weight: 800;
    }

    #lossvalue {
      color: var(--danger);
      font-weight: 700;
    }

    #profitvalue {
      color: var(--primary);
      font-weight: 700;
    }

    #plvalue {
      color: var(--success);
      font-weight: 700;
    }

    /* --- REFRESH PROGRESS BAR --- */
    .action-group {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    #refreshProgressContainer {
      display: none;
      width: 80px;
      height: 4px;
      background: #e2e8f0;
      border-radius: 10px;
      overflow: hidden;
    }

    #refreshProgressBar {
      width: 0%;
      height: 100%;
      background: var(--primary);
      transition: width 0.3s ease;
    }

    #fetchTrades {
      background: var(--primary);
      color: #fff;
      border: none;
      padding: 10px 18px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
    }

    /* --- GRAPHICAL PLACEHOLDER --- */
    .section-title {
      font-size: 1rem;
      color: var(--text-muted);
      margin-top: 30px;
    }

    #HistoricalgraphicalContract {
      background: #f8fafc;
      border: 1px dashed var(--border);
      border-radius: 16px;
      min-height: 350px;
    }

    /* Conteneur de badge de base */
    .badge-status {
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      display: inline-block;
      letter-spacing: 0.5px;
    }

    /* Style sp√©cifique WIN (Succ√®s) */
    .badge-win {
      background-color: rgba(16, 185, 129, 0.1);
      /* Vert tr√®s clair */
      color: #059669;
      /* Vert for√™t */
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    /* Style sp√©cifique LOSS (√âchec) */
    .badge-loss {
      background-color: rgba(239, 68, 68, 0.1);
      /* Rouge tr√®s clair */
      color: #dc2626;
      /* Rouge vif */
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    /* -- Foot Page --- */
    footer {
      width: 100%;
      background-color: #f8f9fa;
      /* gris fonc√© */
      color: gray;
      text-align: center;
      padding: 12px 0;
      font-size: 14px;
      position: relative;
      /* reste visible en bas de l‚Äô√©cran */
      bottom: 0;
      left: 0;
      z-index: 1000;
      /*box-shadow: 0 -2px 8px rgba(0,0,0,0.2);*/
    }

    /* Conteneur horizontal */
    #symbolList {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      padding: 12px;
      white-space: nowrap;

      background: rgba(255, 255, 255, 0.15);
      border-radius: 18px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);

      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);

      scrollbar-width: thin;
      scrollbar-color: rgba(255, 255, 255, 0.4) transparent;
    }

    /* Item individuel */
    .symbol-item {
      padding: 10px 18px;
      background: rgba(255, 255, 255, 0.12);
      border-radius: 14px;
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;
      color: #2e2a2a;
      border: 1px solid whitesmoke;
      transition: all 0.25s ease;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }

    /* Hover ‚Üí whitesmoke */
    .symbol-item:hover {
      background: whitesmoke;
      color: #000;
      transform: translateY(-2px);
    }

    /* S√©lection ‚Üí whitesmoke aussi */
    .symbol-item.selected {
      background: whitesmoke;
      color: #000;
      border: 1px solid rgba(255, 255, 255, 0.6);
      box-shadow: 0 0 12px rgba(255, 255, 255, 0.6);
    }

    .trade-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .trade-table thead th {
      position: sticky;
    }

    .trade-header h3 {
      color: rgb(25, 24, 24);
      margin: 0;
      padding-top: 10px;
    }

    .trade-header button {
      background-color: transparent;
      color: gray;
      background: white;
      border: 1px solid white;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    }

    .trade-header button:hover {
      background-color: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.12);
    }

    #HistoricalContract {
      margin-top: 5px;
      /* ou plus selon la hauteur des gauges */
      padding-bottom: 45px;
    }

    #tradeHistory {
      margin-top: 40px;
      padding-bottom: 30px;
      margin-bottom: 40px;
    }

    /* === Overlay === */
    /* --- Fen√™tre Modale Chart Type --- */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(15, 23, 42, 0.4);
      /* Overlay sombre l√©ger */
      backdrop-filter: blur(4px);
      /* Effet de flou en arri√®re-plan */
    }

    .modal-content {
      background-color: #ffffff;
      margin: 10% auto;
      padding: 0;
      border-radius: 20px;
      width: 90%;
      max-width: 450px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      overflow: hidden;
      font-family: 'Inter', sans-serif;
    }

    /* Header de la modale */
    .modal-header {
      padding: 20px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #f1f5f9;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 700;
      color: #1e293b;
    }

    .close {
      font-size: 24px;
      color: #94a3b8;
      cursor: pointer;
      transition: color 0.2s;
    }

    .close:hover {
      color: #ef4444;
    }

    /* Corps de la modale */
    .modal-body {
      padding: 24px;
    }

    h4 {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #64748b;
      margin-bottom: 16px;
    }

    .divider {
      height: 1px;
      background: #f1f5f9;
      margin: 24px 0;
    }

    /* --- Boutons Styles (Chips) --- */
    .chart-type-section,
    .interval-section {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .chart-type-btn,
    .interval-btn {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      color: #475569;
      padding: 10px 16px;
      border-radius: 10px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .interval-btn {
      padding: 8px 12px;
      min-width: 55px;
      justify-content: center;
    }

    /* √âtats Active & Hover */
    .chart-type-btn:hover,
    .interval-btn:hover {
      background: #f1f5f9;
      border-color: #cbd5e1;
      transform: translateY(-1px);
    }

    .chart-type-btn.active,
    .interval-btn.active {
      background: #2563eb;
      border-color: #2563eb;
      color: #ffffff;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    /* Ic√¥nes discr√®tes */
    .icon {
      font-size: 1.1rem;
    }


    /* SYMBOL INFO */
    #gold-info-section {
      background: #ffffff;
      border-radius: 14px;
      padding-top: 3px;
      box-shadow: 0 4px 18px rgba(0, 0, 0, 0.08);
      border: 1px solid #e8e8e8;
      margin-top: 5px;
    }

    #gold-info-container {
      background: #fafafa;
      border-radius: 10px;
      border: 1px solid #efefef;
      overflow: hidden;
      margin-top: 7px;
    }

    /*---------------------------------------------*/

    #accountSelect option {
      border-radius: 8px;
      border: 1px solid #e1dddd;
      background: #fafafa;
      color: #212325;
      font-size: 14px;
      cursor: pointer;
    }

    #panel h1 {
      width: 100%;
      text-align: left;
      font-size: 17px;
      color: #222;
      margin-bottom: 12px;
    }

    /* =====================================================   
   POPUP OVERLAY GLASS
===================================================== */
    /* Overlay & Panel */
    .cashier-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      display: none;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(5px);
      z-index: 9999;
      font-family: 'Inter', sans-serif;
    }

    .cashier-panel {
      background: #ffffff;
      width: 100%;
      max-width: 480px;
      border-radius: 20px;
      border: 1px solid #f1f5f9;
      /* Bordure tr√®s claire */
      padding: 25px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
      /* Ombre profonde pour d√©coller du fond */
      display: flex;
      flex-direction: column;
    }

    /* Headers */
    .cashier-header h2 {
      margin: 0;
      color: var(--text-dark);
      font-size: 22px;
    }

    .cashier-header p {
      font-size: 13px;
      color: var(--text-light);
      margin-top: 5px;
      margin-bottom: 20px;
    }

    /* Scroll Area */
    .cashier-scroll-area {
      max-height: 60vh;
      overflow-y: auto;
      padding-right: 10px;
      margin-bottom: 20px;
    }

    .cashier-scroll-area::-webkit-scrollbar {
      width: 4px;
    }

    .cashier-scroll-area::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 10px;
    }

    /* Inputs & Labels */
    label {
      display: block;
      font-size: 11px;
      font-weight: 700;
      color: var(--text-light);
      text-transform: uppercase;
      margin-bottom: 6px;
    }

    input,
    select {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      font-size: 14px;
      color: var(--text-dark);
      transition: all 0.2s;
      box-sizing: border-box;
    }

    input:focus,
    select:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    /* Layout Grids */
    .grid-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }

    .input-section {
      margin-bottom: 15px;
    }

    .email-flex {
      display: flex;
      gap: 10px;
    }

    .email-flex button {
      white-space: nowrap;
      padding: 0 15px;
      border-radius: 10px;
      border: none;
      background: #f1f5f9;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
    }

    .divider {
      height: 1px;
      background: #f1f5f9;
      margin: 15px 0;
    }

    /* Bouton Principal (Lancer la transaction) */
    .btn-main {
      background: #ffffff;
      color: var(--primary-color);
      /* Texte bleu pour le contraste */
      border: 2px solid var(--primary-color);
      padding: 14px;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
      margin-bottom: 10px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .btn-main:hover {
      background: var(--primary-color);
      color: #ffffff;
      /* S'inverse au survol */
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(37, 99, 235, 0.2);
    }

    /* Bouton Secondaire (Envoyer code/V√©rifier) */
    #sendEmailBtn {
      background: #ffffff;
      color: var(--text-dark);
      border: 1px solid var(--border-color);
      padding: 0 20px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    #sendEmailBtn:hover {
      background: #f8fafc;
      border-color: var(--text-light);
    }

    #validateCodeBtn:active {
      transform: scale(0.98);
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    /* Bouton Annuler / Fermer */
    .btn-close {
      background: #ffffff;
      border: 1px solid #e2e8f0;
      color: #94a3b8;
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-close:hover {
      color: var(--danger);
      border-color: var(--danger);
      background: #fff1f2;
    }

    /* Fee Indicator */
    .fee-container {
      background: #f8fafc;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 15px;
      border: 1px dashed var(--border-color);
    }

    .fee-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      font-weight: 600;
    }

    #feeBadge {
      padding: 2px 6px;
      border-radius: 4px;
      color: white;
      font-size: 9px;
    }

    .fee-progress-bg {
      height: 5px;
      background: #e2e8f0;
      border-radius: 10px;
      margin-top: 6px;
      overflow: hidden;
    }

    #feeBar {
      height: 100%;
      width: 0%;
      /* Commence √† z√©ro */
      transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.4s;
      border-radius: 10px;
    }

    /* Statuses */
    .checkbox-row {
      display: flex;
      align-items: center;
      /* Aligne verticalement le carreau et le texte */
      justify-content: flex-start;
      /* Force l'alignement tout √† gauche */
      gap: 10px;
      /* Espace fixe entre le carreau et le texte */
      margin: 15px 0;
      width: 100%;
      /* S'assure de prendre toute la largeur pour l'alignement */
    }

    .checkbox-row input[type="checkbox"] {
      width: 18px;
      /* Taille fixe pour √©viter qu'il ne s'√©tire */
      height: 18px;
      margin: 0;
      /* Supprime les marges par d√©faut du navigateur */
      cursor: pointer;
    }

    .check-label {
      font-size: 13px;
      color: var(--text-dark);
      text-transform: none;
      /* D√©sactive les majuscules si vous en aviez mis */
      font-weight: 500;
      cursor: pointer;
      margin: 0;
      /* Supprime toute marge qui pousserait le texte */
      line-height: 1;
      /* Aligne bien le texte avec le milieu de la checkbox */
    }

    #errorBox {
      font-size: 12px;
      text-align: center;
      margin-top: 5px;
      min-height: 15px;
    }

    /* Webview Popup */
    .webview-popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }

    .webview-box {
      background: white;
      width: 90%;
      max-width: 900px;
      height: 85vh;
      border-radius: 15px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .webview-header {
      background: #1e222d;
      color: white;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #webviewFrame {
      flex-grow: 1;
      border: none;
      width: 100%;
    }

    /* ML */
    #overlayML {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    #countdown {
      font-size: 100px;
      font-weight: bold;
      color: #ffffff;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        opacity: 1;
      }

      50% {
        transform: scale(1.2);
        opacity: 0.7;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* ================= TRADE HISTORY STYLES ================= */

    #tradeHistoryContainer__ {
      background: var(--bg-main);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid var(--border-color);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      max-width: 100%;
    }

    /* Header */
    .header-flex {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }

    .tradeHistoryTitle__ {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-dark);
      margin: 0;
      display: flex;
      align-items: center;
    }

    #tradeHistoryStatus__ {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--brand-blue);
      background: rgba(72, 52, 212, 0.08);
      padding: 5px 12px;
      border-radius: 20px;
    }

    /* Tableau */
    .tradeHistoryTableWrapper__ {
      width: 100%;
      overflow-x: auto;
    }

    #tradeHistoryTable__ {
      width: 100%;
      border-collapse: collapse;
      text-align: left;
    }

    #tradeHistoryTable__ th {
      padding: 12px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-gray);
      border-bottom: 2px solid var(--bg-sub);
      background: var(--bg-sub);
    }

    #tradeHistoryTable__ td {
      padding: 14px 12px;
      border-bottom: 1px solid var(--border-color);
      font-size: 0.9rem;
      color: var(--text-dark);
      vertical-align: middle;
    }

    /* Animation d'entr√©e des nouveaux signaux */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
        background: #f0f3ff;
      }

      to {
        opacity: 1;
        transform: translateY(0);
        background: transparent;
      }
    }

    .new-signal-row {
      animation: slideIn 0.5s ease-out forwards;
    }

    /* Badges Signal */
    .signal-badge-buy-light {
      background: rgba(0, 184, 148, 0.12);
      color: var(--success-green);
      padding: 4px 10px;
      border-radius: 6px;
      font-weight: 700;
      font-size: 0.75rem;
      border: 1px solid rgba(0, 184, 148, 0.2);
    }

    .signal-badge-sell-light {
      background: rgba(214, 48, 49, 0.1);
      color: var(--danger-red);
      padding: 4px 10px;
      border-radius: 6px;
      font-weight: 700;
      font-size: 0.75rem;
      border: 1px solid rgba(214, 48, 49, 0.2);
    }

    /* Indicateur de Probabilit√© */
    .prob-container-light {
      display: flex;
      flex-direction: column;
      gap: 5px;
      min-width: 90px;
    }

    .prob-bar-bg-light {
      width: 100%;
      height: 4px;
      background: #eee;
      border-radius: 2px;
      overflow: hidden;
    }

    .prob-bar-fill-light {
      height: 100%;
      transition: width 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    /* Polices Sp√©cifiques */
    .time-dim-light {
      color: var(--text-light);
      font-size: 0.8rem;
      font-family: 'JetBrains Mono', monospace;
    }

    .price-mono-light {
      font-family: 'JetBrains Mono', monospace;
      color: var(--brand-blue);
      font-weight: 600;
    }

    .symbol-light {
      font-weight: 700;
      color: var(--text-dark);
    }

    /* Live Pulse Icon */
    .live-pulse {
      width: 8px;
      height: 8px;
      background: var(--success-green);
      border-radius: 50%;
      margin-left: 10px;
      display: inline-block;
      box-shadow: 0 0 8px var(--success-green);
      animation: pulse-ring 2s infinite;
    }

    @keyframes pulse-ring {
      0% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(0, 184, 148, 0.7);
      }

      70% {
        transform: scale(1);
        box-shadow: 0 0 0 6px rgba(0, 184, 148, 0);
      }

      100% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(0, 184, 148, 0);
      }
    }

    .open-btn {
      padding: 10px 15px;
      background: #2962FF;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      border-radius: 4px;
    }

    /* Fond de l'overlay (assombrissement de l'arri√®re-plan) */
    .overlay_ {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      /* Noir transparent doux */
      backdrop-filter: blur(4px);
      /* Effet de flou derri√®re la popup */
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .hidden {
      display: none !important;
    }

    /* La Popup */
    .popup {
      background: #ffffff;
      width: 90%;
      max-width: 350px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      animation: fadeIn 0.3s ease-out;
    }

    /* En-t√™te de la popup */
    .popup-header {
      padding: 15px 20px;
      background: #f8f9fa;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #333;
      font-weight: 600;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 18px;
      color: #999;
      cursor: pointer;
      transition: color 0.2s;
    }

    .close-btn:hover {
      color: #ff4d4d;
    }

    /* Corps de la popup */
    .popup-body {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    /* Style des boutons (Fond blanc, ombre douce) */
    .popup-body button {
      width: 100%;
      padding: 12px;
      background: #ffffff;
      border: 1px solid #f0f0f0;
      border-radius: 10px;
      color: #444;
      font-weight: 500;
      cursor: pointer;
      text-align: left;
      transition: all 0.2s ease;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
      /* Ombre tr√®s l√©g√®re */
    }

    /* Effet au survol */
    .popup-body button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      border-color: #d1d4dc;
    }

    /* --- √âtats Actifs (G√©r√©s par vos classes existantes) --- */
    .popup-body button.active-20 {
      background: #2962FF !important;
      color: white;
      border-color: #2962FF;
    }

    .popup-body button.active-50 {
      background: #9c27b0 !important;
      color: white;
      border-color: #9c27b0;
    }

    .popup-body button.active-200 {
      background: #ff9800 !important;
      color: white;
      border-color: #ff9800;
    }

    .popup-body button.active {
      background: #88ff00 !important;
      color: rgb(71, 68, 68);
      border-color: #88ff00;
    }

    /* Style pour les boutons d'objets (Trendline, etc.) */
    .popup-body button:not([id]) {
      background: #fdfdfd;
      color: #555;
      border-left: 4px solid #eee;
      /* Petite barre d√©corative √† gauche */
    }

    @keyframes fade¬≤In {
      from {
        opacity: 0;
        transform: scale(0.95);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes pulse-red {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(255, 61, 96, 0.7);
      }

      70% {
        transform: scale(1.05);
        box-shadow: 0 0 0 10px rgba(255, 61, 96, 0);
      }

      100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(255, 61, 96, 0);
      }
    }

    /* Animation de succ√®s pour le bouton */
    .btn-success-flash {
      animation: flash-green 0.6s ease-out;
    }

    @keyframes flash-green {
      0% {
        background-color: #00ffa3;
        box-shadow: 0 0 20px #00ffa3;
        transform: scale(1.05);
      }

      100% {
        background-color: transparent;
        /* Ou votre couleur de bouton initiale */
        box-shadow: 0 0 0px transparent;
        transform: scale(1);
      }
    }

    /* Animation de flash rouge pour les pertes */
    .btn-danger-flash {
      animation: flash-red 0.6s ease-out;
    }

    @keyframes flash-red {
      0% {
        background-color: #ff3d60;
        box-shadow: 0 0 20px #ff3d60;
        transform: scale(1.05);
      }

      100% {
        background-color: transparent;
        box-shadow: 0 0 0px transparent;
        transform: scale(1);
      }
    }

    #toast-container {
      position: fixed;
      /* Positionnement en bas √† droite */
      bottom: 25px;
      right: 25px;
      /* Largeur maximale pour ne pas encombrer l'√©cran */
      width: 320px;
      /* Z-index tr√®s √©lev√© pour passer devant le contractsPanel et les graphiques */
      z-index: 10000;

      /* Flexbox pour empiler les notifications de bas en haut */
      display: flex;
      flex-direction: column-reverse;
      gap: 12px;

      /* Emp√™che de bloquer les clics sur les √©l√©ments en dessous si vide */
      pointer-events: none;
    }

    /* On r√©active les clics uniquement sur les toasts eux-m√™mes */
    .toast {
      pointer-events: auto;

      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(8px);
      /* Effet de flou moderne */
      border-radius: 10px;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1),
        0 8px 10px -6px rgba(0, 0, 0, 0.1);

      /* Animation fluide */
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .btn-main-action {
      /* Base identique au connectBtn */
      background: #2962ff;
      color: #ffffff;
      padding: 12px 15px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;

      /* Alignement pour plus de propret√© */
      display: inline-flex;
      align-items: center;
      justify-content: center;

      /* Animation de transition douce */
      transition: background 0.2s ease, transform 0.1s ease;
    }

    /* Style au survol (Bleu plus sombre) */
    .btn-main-action:hover {
      background: #1e53e5;
    }

    /* Effet de clic (l√©g√®re r√©duction de taille) */
    .btn-main-action:active {
      transform: scale(0.98);
    }

    .tv-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      /* Fond assombri pour faire ressortir le blanc */
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .tv-modal-overlay.active {
      display: flex;
    }

    .tv-modal {
      background: var(--bg-white);
      /* DIMENSIONS AGRANDIES */
      width: 600px;
      max-height: 90vh;
      border-radius: 12px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
    }

    .tv-modal-header {
      padding: 20px 25px;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 18px;
      font-weight: 600;
    }

    .tv-modal-body {
      padding: 25px;
      overflow-y: auto;
    }

    /* Style des contr√¥les en blanc */
    .search-container input,
    #categorySelect {
      width: 100%;
      background: var(--bg-white);
      /* Fond blanc */
      border: 1px solid var(--border-light);
      color: var(--text-dark);
      padding: 12px 15px;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 20px;
      outline: none;
      transition: border-color 0.2s;
    }

    .search-container input:focus,
    #categorySelect:focus {
      border-color: var(--accent-blue);
    }

    .rounded-container {
      background: #fafafa;
      /* Gris tr√®s l√©ger pour contraster avec les items blancs */
      border-radius: 15px;
      padding: 20px;
      border: 1px solid var(--border-light);
      min-height: 350px;
      /* HAUTEUR ACCRUE */
    }

    .symbol-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    /* Vos items renomm√©s avec style blanc arrondi */
    .asset-selector-item {
      background: var(--bg-white);
      border: 1px solid var(--border-light);
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .asset-selector-item:hover {
      background: var(--hover-bg);
      border-color: var(--accent-blue);
    }

    .asset-selector-item.selected {
      background: var(--accent-blue);
      color: white;
      border-color: var(--accent-blue);
    }

    .tv-modal-footer {
      padding: 20px 25px;
      border-top: 1px solid var(--border-light);
      display: flex;
      justify-content: flex-end;
      gap: 15px;
    }

    .btn-validate {
      background: var(--accent-blue);
      color: white;
      border: none;
      padding: 10px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
  </style>
</head>

<body>
  <header>
    <div id="symbolList"></div>
    <div id="controls">
      <button id="openPickerBtn" class="btn-main-action">Symbols</button>
      <button id="connectBtn">Connect</button>
    </div>
  </header>

  <div class="tv-modal-overlay" id="modalOverlay">
    <div class="tv-modal">
      <div class="tv-modal-header">
        <span>Select an instrument</span>
        <button class="close-icon" onclick="closeModal()">&times;</button>
      </div>

      <div class="tv-modal-body">
        <div class="search-container">
          <input type="text" id="symbolSearch" placeholder="Search a symbol..." oninput="filterSymbols()" autocomplete="off">
        </div>

        <div class="field-group">
          <label>Cat√©gorie</label>
          <select id="categorySelect" onchange="updateSymbols()">
            <option value="metals">Metals</option>
            <option value="crypto">Cryptocurrencies</option>
            <option value="minor">Minor Pairs</option>
            <option value="major" selected>Major Pairs</option>  
            <option value="step">Step Indices</option>   
            <option value="jump">Jump Indices</option>    
            <option value="crash">Crash/Boom Indices</option>
            <option value="continuous">Continuous Indices</option>
          </select>
        </div>

        <div class="field-group">
          <label>Symbols available</label>
          <div id="symbolGrid" class="symbol-grid rounded-container">
          </div>
        </div>
      </div>

      <div class="tv-modal-footer">
        <button class="btn-close" onclick="closeModal()">Close</button>
        <button id="validateBtn" class="btn-validate" disabled onclick="confirmSelection()">Validate</button>
      </div>
    </div>
  </div>

  <section class="widget-section full-width" id="gold-info-section">
    <div id="gold-info-container" class="tradingview-widget-container"></div>
  </section>

  <!-- Panneau complet de contr√¥le sous le chart -->
  <div id="controlFormPanel">
    <div>
      <!-- Left buttons -->
      <div style="display:flex; gap:12px; flex-wrap:wrap;">
        <button class="open-btn" id="START">Start Automation</button>
        <button id="STOP">Stop Automation</button>
        <button id="openPopupBtn__" class="open-btn">Indicators</button>
        <button id="openCashierBtn">Cashier</button>
        <button id="buyBtn">BUY</button>
        <button id="sellBtn">SELL</button>
        <button id="reverseBtn">Reverse Position</button>
        <button id="closeWinning">Close Winning</button>
        <button id="closeLosing">Close Losing</button>
        <button id="closeAll">Close All</button>
        <button id="openPopup">Chart Types</button>
        <button id="DatasettingPopup">Trade setting</button>
        <div id="accountInfo" style="margin-left:200px; font-weight:500; color:#333;"></div>
      </div>
    </div>
  </div>

  <div id="overlayML">
    <div id="countdown">5</div>
  </div>

  <!-- Bouton pour afficher / cacher le panneau -->
  <button id="controlPanelToggle">‚öôÔ∏è Show Controls</button>

  <div id="settingsPopup" class="popup-overlay">
    <div class="popup-box">
      <h2>Trade Settings</h2>
      <div class="popup-content">
        <div class="input-field">
          <select id="multiplierSelect">
            <option value="" disabled selected>Multiplier</option>
            <option value="40">40</option>
            <option value="50">50</option>
            <option value="100">100</option>
            <option value="150">150</option>
            <option value="200">200</option>
            <option value="250">250</option>
            <option value="300">300</option>
            <option value="400">400</option>
            <option value="500">500</option>
            <option value="1200">1200</option>
            <option value="3000">3000</option>
          </select>
        </div>

        <div class="input-field">
          <input type="number" id="stakeInput" min="1" placeholder="Stake Amount">
        </div>

        <div class="input-row">
          <div class="input-field">
            <input type="number" id="buyNumberInput" min="1" placeholder="Buy Count">
          </div>
          <div class="input-field">
            <input type="number" id="sellNumberInput" min="1" placeholder="Sell Count">
          </div>
        </div>

        <div class="input-row">
          <div class="input-field tp">
            <input type="number" id="tpInput" min="0" placeholder="Take Profit">
          </div>
          <div class="input-field sl">
            <input type="number" id="slInput" min="0" placeholder="Stop Loss">
          </div>
        </div>
      </div>

      <div class="popup-buttons">
        <button id="closePopupBtn">Close</button>
        <button id="savePopupBtn">Save Settings</button>
      </div>
    </div>
  </div>

  <!-- TradingView Widget BEGIN -->
  <div id="ticker-container" class="tradingview-widget-container"></div>
  <!-- TradingView Widget END -->

  <div id="container__">
    <div id="chartArea">

      <div id="toast-container"></div>

      <div id="pnl-container">
        <span class="pnl-label">PnL Global:</span>
        <span id="total-pnl">0.00</span>
        <span id="pnl-arrow"></span>
        <span class="pnl-currency">$</span>
      </div>

      <div id="chartInner"></div>
      <div id="chart-tooltip"></div>
      <canvas id="Trendoverlay__"></canvas>
      <div id="context-menu">
        <div id="deleteItem" class="menu-item">Supprimer</div>
        <div id="visibilityItem" class="menu-item">Masquer tout</div>
        <div id="lockFiboItem" class="menu-item">Verrouiller Fibo</div>
      </div>

    </div>
  </div>

  <div id="tradeHistoryContainer__" class="glass-panel">
    <div class="header-flex">
      <h2 class="tradeHistoryTitle__">AI-TCN Engine <span class="live-pulse"></span></h2>
      <div id="tradeHistoryStatus__">Standby</div>
    </div>

    <div class="tradeHistoryTableWrapper__">
      <table id="tradeHistoryTable__">
        <thead>
          <tr id="tradeHistoryHeaderRow__">
            <th class="th-tick-time">Time</th>
            <th class="th-symbol">Asset</th>
            <th class="th-signal">Signal</th>
            <th class="th-price">Entry Price</th>
            <th class="th-prob">Confidence</th>
          </tr>
        </thead>
        <tbody id="tradeHistoryBody__">
        </tbody>
      </table>
    </div>
  </div>

  <!-- OVERLAY -->
  <div id="indicatorOverlay" class="overlay_ hidden">
    <div class="popup">
      <div class="popup-header">
        <span>Indicateurs & Objets</span>
        <button class="close-btn" onclick="closePopup()">‚úñ</button>
      </div>

      <div class="popup-body">
        <!-- Indicateurs -->
        <button id="ma20" onclick="toggleMA(20, this)">MA 20 : OFF</button>
        <button id="ma50" onclick="toggleMA(50, this)">MA 50 : OFF</button>
        <button id="ma200" onclick="toggleMA(200, this)">MA 200 : OFF</button>
        <button id="ZigZag" onclick="toggleZigZag(this)">ZigZag 14 : OFF</button>
        <button class="btn-drawing" onclick="enableFibonacci(this)">Fibonacci Levels</button>

        <!-- Objets graphiques -->
        <button class="btn-drawing" onclick="enableTrendline(this)">Trendline</button>
        <button class="btn-drawing" onclick="enableRectangle(this)">Rectangle</button>
        <button class="btn-drawing" onclick="enableTPSL(this)">TP / SL</button>
      </div>
    </div>
  </div>

  <!-- === Popup de s√©lection === -->
  <div id="chartTypeModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Chart Settings</h3>
        <span class="close" id="closeModal">&times;</span>
      </div>

      <div class="modal-body">
        <section>
          <h4>Chart Style</h4>
          <div class="chart-type-section">
            <button class="chart-type-btn" data-type="line">
              <span class="icon">üìà</span> Line
            </button>
            <button class="chart-type-btn" data-type="area">
              <span class="icon">üìä</span> Area
            </button>
            <button class="chart-type-btn active" data-type="candlestick">
              <span class="icon">üïØÔ∏è</span> Candlestick
            </button>
          </div>
        </section>

        <div class="divider"></div>

        <section>
          <h4>Time Interval</h4>
          <div class="interval-section">
            <button class="interval-btn" data-interval="1t">1t</button>
            <button class="interval-btn active" data-interval="1m">1m</button>
            <button class="interval-btn" data-interval="2m">2m</button>
            <button class="interval-btn" data-interval="3m">3m</button>
            <button class="interval-btn" data-interval="5m">5m</button>
            <button class="interval-btn" data-interval="10m">10m</button>
            <button class="interval-btn" data-interval="15m">15m</button>
            <button class="interval-btn" data-interval="30m">30m</button>
            <button class="interval-btn" data-interval="1h">1h</button>
            <button class="interval-btn" data-interval="2h">2h</button>
            <button class="interval-btn" data-interval="4h">4h</button>
            <button class="interval-btn" data-interval="8h">8h</button>
            <button class="interval-btn" data-interval="1d">1d</button>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- Nouveau panneau des Trades -->
  <div id="tradeEvaluationContainer">
    <button id="tradeEvalToggle">‚öôÔ∏è Account Management</button>

    <div id="tradeEvalPanel">
      <div id="tradeSummary">
        <div class="trade-info">
          <label>Balance</label>
          <span id="balanceValue">-</span>
        </div>
        <div class="trade-info">
          <label>Account Holder</label>
          <span id="accountHolder">-</span>
        </div>
        <div class="trade-info">
          <label>Accounts</label>
          <div class="account-actions">
            <select id="accountSelect">
              <option value="">Select Account Type</option>
            </select>
            <button id="deleteSelectedAccount" title="Supprimer">üóëÔ∏è</button>
          </div>
        </div>

        <div class="trade-dates">
          <div class="date-group">
            <label>Start Date</label>
            <input type="date" id="startDate" value="2025-10-01">
          </div>
          <div class="date-group">
            <label>End Date</label>
            <input type="date" id="endDate" value="2025-10-31">
          </div>
        </div>
      </div>

      <div id="tradeCharts">
        <div class="circle-chart red">
          <div class="chart-container">
            <svg viewBox="0 0 36 36" class="circular-chart">
              <path class="circle-bg"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
              <path id="circle-loss-path" class="circle" stroke-dasharray="0, 100"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
            </svg>
            <div class="inner-content"><span id="loss">0%</span></div>
          </div>
          <label>Loss: <span id="lossvalue">0 <span id="losscurrency">USD</span></span></label>
        </div>

        <div class="circle-chart blue">
          <div class="chart-container">
            <svg viewBox="0 0 36 36" class="circular-chart">
              <path class="circle-bg"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
              <path id="circle-profit-path" class="circle" stroke-dasharray="0, 100"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
            </svg>
            <div class="inner-content"><span id="profit">0%</span></div>
          </div>
          <label>Profit: <span id="profitvalue">0 <span id="profitcurrency">USD</span></span></label>
        </div>

        <div class="circle-chart mix">
          <div class="chart-container">
            <svg viewBox="0 0 36 36" class="circular-chart">
              <path class="circle-bg"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
              <path id="circle-pl-path" class="circle" stroke-dasharray="0, 100"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
            </svg>
            <div class="inner-content"><span id="pl">0%</span></div>
          </div>
          <label>P/L: <span id="plvalue">0 <span id="plcurrency">USD</span></span></label>
        </div>
      </div>

      <h3 class="section-title">Contrats Representation</h3>
      <div id="HistoricalgraphicalContract"></div>

      <p id="message"></p>

      <div id="tradeHistory">
        <div class="trade-header">
          <h3>Trade History</h3>
          <div class="action-group">
            <div id="refreshProgressContainer">
              <div id="refreshProgressBar"></div>
            </div>
            <button id="fetchTrades">Refresh Table</button>
          </div>
        </div>
        <div id="HistoricalContract"></div>
      </div>
    </div>
  </div>

  <!-- Nouveau panneau des contrats ouverts -->
  <div id="contractsPanelContainer">
    <button id="contractsPanelToggle">üìÑ Show Open Contracts</button>

    <div id="contractsPanel">

      <div class="donuts-wrapper">
        <div class="donut-card">
          <svg viewBox="0 0 36 36" class="donut-svg">
            <path class="donut-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831">
            </path>
            <path id="panel-circle-profit-path" class="donut-path profit"
              d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
              stroke-dasharray="0, 100"></path>
            <text x="18" y="20.35" class="donut-text" id="panel-profit-percent-text">0%</text>
          </svg>
          <div class="donut-info">Profits: <span id="panel-profitvalue">0.00</span></div>
        </div>

        <div class="donut-card">
          <svg viewBox="0 0 36 36" class="donut-svg">
            <path class="donut-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831">
            </path>
            <path id="panel-circle-loss-path" class="donut-path loss"
              d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
              stroke-dasharray="0, 100"></path>
            <text x="18" y="20.35" class="donut-text" id="panel-loss-percent-text">0%</text>
          </svg>
          <div class="donut-info">Loss: <span id="panel-lossvalue">0.00</span></div>
        </div>
      </div>

      <div id="autoHistoryList"></div>
    </div>
  </div>

  <!-- Nouveau panneau des Calendriers economiques -->
  <div class="container">
    <div class="panel" id="panel">
      <h1>Economic calendar</h1>
      <div class="toolbar">
        <label class="muted small">Token Deriv:</label>
        <input type="text" id="tokencalendar" placeholder="Enter your token..." style="min-width:200px" />

        <label class="muted small">Devise:</label>
        <select id="currency">
          <option value="USD">USD</option>
          <option value="CNH">CNY</option>
          <option value="EUR">EUR</option>
          <option value="JPY">JPY</option>
          <option value="GBP">GBP</option>
          <option value="AUD">AUD</option>
          <option value="CAD">CAD</option>
          <option value="MXN">MXN</option>
          <option value="CHF">CHF</option>
        </select>

        <label class="muted small">Start:</label>
        <input type="date" id="startDate" />
        <label class="muted small">End:</label>
        <input type="date" id="endDate" />

        <label class="muted small">Filter:</label>
        <input type="text" id="search" placeholder="Search your keywords" />
        <select id="impactFilter">
          <option value="">Impact: All</option>
          <option value="High">High</option>
          <option value="Medium">Medium</option>
          <option value="Low">Low</option>
        </select>
        <button id="fetchCalendar">üìÖ Load</button>
        <button id="refresh">üîÅ Refresh</button>
        <button onclick="exportSelectedToCSV()" class="btn-export">
          <span class="icon">üì•</span> Export CSV
        </button>
        <div style="flex:1"></div>
        <span id="status" class="muted small">statut: ready</span>
      </div>

      <div class="table-wrap">
        <div id="CalendarList"></div>
      </div>

    </div>
  </div>

  <!-- =======================
     POPUP CASHIER (Glass)
     ======================= -->
  <div class="cashier-overlay" id="cashierModal">
    <div class="cashier-panel">
      <div class="cashier-header">
        <h2>Deriv Cashier</h2>
        <p>Effectuez vos transactions en toute s√©curit√© via l'API officielle.</p>
      </div>

      <div class="cashier-scroll-area">
        <div class="input-section">
          <label>Email du compte Deriv</label>
          <div class="email-flex">
            <input type="email" id="emailInput" placeholder="exemple@mail.com" />
            <button id="sendEmailBtn">V√©rifier</button>
          </div>
          <small class="helper-text">Obligatoire pour les retraits.</small>
        </div>

        <div class="divider"></div>

        <div class="grid-inputs">
          <div class="input-group">
            <label>Login ID</label>
            <input type="text" id="loginidInput" placeholder="ex: CR123456" />
          </div>
          <div class="input-group">
            <label>Op√©ration</label>
            <select id="actionSelect">
              <option value="deposit">D√©p√¥t</option>
              <option value="withdraw">Retrait</option>
            </select>
          </div>
        </div>

        <div class="grid-inputs">
          <div class="input-group">
            <label>Provider</label>
            <select id="providerSelect">
              <option value="doughflow">Doughflow (Fiat)</option>
              <option value="crypto">Crypto (Direct)</option>
              <option value="cashier">Cashier</option>
            </select>
          </div>
          <div class="input-group">
            <label>Type d'Interface</label>
            <select id="typeSelect">
              <option value="url">Lien URL</option>
              <option value="api">API Directe</option>
            </select>
          </div>
        </div>

        <div class="grid-inputs">
          <div class="input-group">
            <label>Montant (Amount)</label>
            <input type="number" id="amountInput" placeholder="0.00" step="0.01" />
          </div>
          <div class="input-group">
            <label>Devise (Currency)</label>
            <input type="text" id="currencySelect" placeholder="USD, USDT, BTC..." />
          </div>
        </div>

        <div class="input-section" id="cryptoFields" style="display:none;">
          <label>Adresse Wallet de destination</label>
          <input type="text" id="addressInput" placeholder="Adresse blockchain (ex: 1A1z...)" />
        </div>

        <div class="input-section">
          <label>Code re√ßu par email</label>
          <input type="text" id="codeInput" placeholder="Code de v√©rification" />
        </div>

        <div class="checkbox-row">
          <input type="checkbox" id="dry_run_check">
          <label for="dry_run_check" class="check-label">Ex√©cuter en mode Test (Dry Run)</label>
        </div>

        <div id="feeIndicator" class="fee-container" style="display:none;">
          <div class="fee-header">
            <span>Priorit√© R√©seau</span>
            <span id="feeBadge">BAS</span>
          </div>
          <div class="fee-progress-bg">
            <div id="feeBar"></div>
          </div>
        </div>

        <div id="errorBox"></div>
      </div>

      <div class="cashier-footer">
        <button id="validateCodeBtn" class="btn-main">G√©n√©rer la transaction</button>
        <button id="closeCashierBtn" class="btn-close">Annuler</button>
      </div>
    </div>
  </div>

  <div class="webview-popup" id="webviewModal">
    <div class="webview-box">
      <div class="webview-header">
        <h3>Op√©ration en cours</h3>
        <button id="closeWebview">&times;</button>
      </div>
      <iframe id="webviewFrame" src="about:blank"></iframe>
    </div>
  </div>

  <script>

    function closePopup() {
      const overlay = document.getElementById('indicatorOverlay');
      if (overlay) {
        overlay.classList.add('hidden');
      }
    }

    // TRADINGVIEW WIDGET
    function createTradingViewEmbed(containerId, src, config, creditHtml) {
      const container = document.getElementById(containerId);
      if (!container) return;

      const placeholder = document.createElement('div');
      placeholder.className = 'tradingview-widget-container__widget';
      container.appendChild(placeholder);

      const s = document.createElement('script');
      s.type = 'text/javascript';
      s.async = true;
      s.src = src;
      s.text = JSON.stringify(config);
      container.appendChild(s);

      if (creditHtml) {
        const cr = document.createElement('div');
        cr.className = 'tradingview-widget-copyright';
        cr.innerHTML = creditHtml;
        container.appendChild(cr);
      }
    }

    // --- 1) Ticker Tape ---
    createTradingViewEmbed('ticker-container',
      'https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js',
      {
        "symbols": [
          { "proName": "FX:GBPUSD", "title": "S&P 500 Index" },
          { "proName": "OANDA:XAUUSD", "title": "Gold to USD" },
          { "proName": "FX_IDC:EURUSD", "title": "EUR to USD" },
          { "proName": "BITSTAMP:BTCUSD", "title": "Bitcoin" },
          { "proName": "BITSTAMP:ETHUSD", "title": "Ethereum" }
        ],
        "colorTheme": "light",
        "locale": "en",
        "isTransparent": false,
        "showSymbolLogo": true,
        "displayMode": "adaptive"
      }
    );

    createTradingViewEmbed(
      'gold-info-container',
      'https://s3.tradingview.com/external-embedding/embed-widget-symbol-info.js',
      {
        "symbol": "OANDA:XAUUSD",
        "colorTheme": "light",
        "isTransparent": false,
        "locale": "en",
        "width": "100%"
      }
    );

    // Toggle panel
    const controlPanelToggle = document.getElementById("controlPanelToggle");
    const controlFormPanel = document.getElementById("controlFormPanel");
    controlPanelToggle.addEventListener("click", () => {
      if (controlFormPanel.style.display === "none" || controlFormPanel.style.display === "") {
        controlFormPanel.style.display = "flex";
        controlPanelToggle.textContent = "‚öôÔ∏è Hide Controls";
      } else {
        controlFormPanel.style.display = "none";
        controlPanelToggle.textContent = "‚öôÔ∏è Show Controls";
      }
    });

    const openPopup = document.getElementById("openPopup");
    const modal = document.getElementById("chartTypeModal");
    const closeModal = document.getElementById("closeModal");

    // Ouvrir le popup
    openPopup.addEventListener("click", () => {
      modal.style.display = "flex";
    });

    // Fermer le popup
    closeModal.addEventListener("click", () => {
      modal.style.display = "none";
    });

    // Fermer en cliquant √† l‚Äôext√©rieur
    modal.addEventListener("click", (e) => {
      if (e.target === modal) {
        modal.style.display = "none";
      }
    });

    // S√©lection du type de graphique
    document.querySelectorAll(".chart-type-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".chart-type-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
      });
    });

    // S√©lection de l‚Äôintervalle
    document.querySelectorAll(".interval-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".interval-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
      });
    });

  </script>
</body>
<footer>
  <p>¬© 2025 World Unicorn ‚Äî All rights reserved </p>
</footer>

</html>