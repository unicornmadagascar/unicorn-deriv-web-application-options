<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ü¶Ñ World Unicorn ‚Äî Deriv Live Ticks</title>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/ml5@0.12.2/dist/ml5.min.js"></script>
  <script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script defer src="app.js"></script>

  <style>
    :root {
      --panel-height: 800px;
      --gap: 7px;
      --bg: #0f1724;
      --card: #ffffff;
      --muted: #94a3b8;
      /* ML Table */
      --bg-main: #ffffff;
      --bg-sub: #f8f9fc;
      --border-color: #eef1f6;
      --text-dark: #2d3436;
      --text-gray: #636e72;
      --text-light: #b2bec3;
      --brand-purple: #89027e;
      /* Votre couleur de probabilit√© */
      --brand-blue: #4834d4;
      /* Couleur pour le prix */
      --success-green: #00b894;
      --danger-red: #d63031;
      /* Account Management */
      --primary: #2563eb;
      --success: #10b981;
      --danger: #ef4444;
      --bg-card: #ffffff;
      --bg-app: #f8fafc;
      --text-main: #0f172a;
      --text-muted: #64748b;
      --border: #e2e8f0;
    }

    .container {
      width: 100%;
      margin-top: 4px;
      margin-left: 14px;
      margin-right: 30px;
      margin-top: 3px;
      padding-top: 2px;
      box-sizing: border-box
    }

    h1 {
      font-size: 18px;
      margin-top: 7px;
      color: #4d4747
    }

    .panel {
      height: var(--panel-height);
      background: #ffffff;
      border-radius: 10px;
      padding: 12px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 8px
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center
    }

    .toolbar input,
    .toolbar select {
      background: transparent;
      border: 1px solid rgba(0, 0, 0, 0.2);
      color: #0f1724;
      padding: 6px 8px;
      border-radius: 6px
    }

    .toolbar button {
      padding: 8px 12px;
      border-radius: 8px;
      border: 0;
      background: #1f6feb;
      color: white;
      cursor: pointer
    }

    .toolbar button:hover {
      background: #2c8eff
    }

    .table-wrap {
      flex: 1;
      overflow: auto;
      border-radius: 6px;
      padding: 6px;
      background: #ffffff;
      border: 1px solid rgba(0, 0, 0, 0.1)
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px
    }

    thead th {
      position: sticky;
      top: 0;
      background: #f5f5f5;
      z-index: 2;
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      cursor: pointer
    }

    tbody td {
      padding: 8px;
      border-bottom: 1px dashed rgba(0, 0, 0, 0.05);
      vertical-align: top
    }

    tbody tr:hover td {
      background: rgba(0, 0, 0, 0.03)
    }

    .muted {
      color: #94a3b8;
      font-size: 13px
    }

    .small {
      font-size: 12px
    }

    .impact-high {
      color: #ff4444;
      font-weight: bold
    }

    .impact-medium {
      color: #ffaa00;
      font-weight: bold
    }

    .impact-low {
      color: #44ff44;
      font-weight: bold
    }

    .importance-box {
      display: inline-block;
      width: 16px;
      height: 16px;
      border-radius: 4px;
      margin-right: 6px;
      vertical-align: middle;
    }

    .impact-1 {
      background-color: #4caf50;
    }

    /* Vert clair - faible */
    .impact-2 {
      background-color: #8bc34a;
    }

    /* Vert moyen */
    .impact-3 {
      background-color: #ffeb3b;
    }

    /* Jaune - mod√©r√© */
    .impact-4 {
      background-color: #ff9800;
    }

    /* Orange - fort */
    .impact-5 {
      background-color: #f44336;
    }

    /* Rouge - tr√®s fort */

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      height: 105vh;
      display: flex;
      flex-direction: column;
      background: #f8f9fa;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 16px;
      background: #fff;
      border-bottom: 1px solid #e6e6e6;
    }

    #symbolList {
      display: flex;
      gap: 10px;
      overflow-x: auto;
    }

    .symbol-item {
      padding: 6px 12px;
      border-radius: 20px;
      background: #eee;
      cursor: pointer;
      font-weight: 600;
      transition: 0.18s;
    }

    .symbol-item:hover {
      background: #007bff;
      color: #fff;
    }

    #container__ {
      position: relative;
      flex: 0;
      flex-direction: column;
      display: flex;
    }

    /* chart area */
    #chartArea {
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
      /* Indispensable pour le positionnement du PnL */
    }

    /* Le graphique lui-m√™me */
    #chartInner {
      flex: 0;
      min-height: 750px;
      background: #fff;
      margin: 12px;
      border-radius: 8px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
      overflow: hidden;
      position: relative;
    }

    /* Style du badge PnL */
    #pnl-container {
      position: absolute;
      top: 25px;
      /* Ajust√© pour √™tre √† l'int√©rieur du margin de 12px */
      right: 35px;
      /* Ajust√© pour ne pas couvrir l'√©chelle des prix */
      z-index: 100;
      font-family: sans-serif;
      font-weight: bold;
      background: rgba(0, 0, 0, 0.75);
      /* Fond sombre pour contraste sur graphique blanc */
      padding: 8px 15px;
      border-radius: 6px;
      color: #fff;
      pointer-events: none;
      /* Permet de cliquer sur le graphique √† travers le texte */
      display: flex;
      align-items: center;
      gap: 5px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    #total-pnl {
      font-size: 1.2em;
    }

    #pnl-arrow {
      font-size: 1.1em;
      transition: all 0.2s ease;
    }

    .pnl-label {
      font-size: 0.75em;
      opacity: 0.8;
      margin-right: 5px;
    }

    /* top controls */
    #controls {
      padding: 8px 16px;
      background: #fff;
      border-bottom: 1px solid #eee;
      display: flex;
      gap: 12px;
      align-items: center;
    }

    #connectBtn {
      background: #007bff;
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }

    #connectBtn:hover {
      background: #0056b3;
    }

    /* --- Control Panel --- */
    #controlFormPanel {
      display: none;
      position: relative;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      padding: 20px;
      margin-top: 10px;
      width: 100%;
      box-sizing: border-box;
      transition: all 0.25s ease-in-out;
    }

    #controlFormPanel div {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    #controlFormPanel button {
      height: 42px;
      padding: 0 16px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    }

    #controlFormPanel button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.12);
    }

    #STOP {
      background-color: white;
      color: #4d4747;
    }

    #START {
      background-color: white;
      color: #4d4747;
    }

    #openPopupBtn__ {
      background-color: white;
      color: #4d4747;
    }

    #openCashierBtn {
      background-color: white;
      color: #4d4747;
    }

    #openPopup {
      background-color: white;
      color: #4d4747;
    }

    #buyBtn {
      background-color: white;
      color: #4d4747;
    }

    #sellBtn {
      background-color: white;
      color: #4d4747;
    }

    #reverseBtn {
      background-color: white;
      color: #4d4747;
    }

    #closeWinning {
      background-color: white;
      color: #4d4747;
    }

    #closeLosing {
      background-color: white;
      color: #4d4747;
    }

    #closeAll {
      background-color: white;
      color: #4d4747;
    }

    #DatasettingPopup {
      background-color: white;
      color: #4d4747;
    }

    /* Overlay sombre */
    /* Overlay flout√© pour focaliser sur le popup */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(4px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      visibility: hidden;
      /* √Ä changer en 'visible' via JS */
      opacity: 0;
      transition: all 0.3s ease;
    }

    .popup-overlay.active {
      visibility: visible;
      opacity: 1;
    }

    /* La Bo√Æte Popup */
    .popup-box {
      background: #fdfdfd;
      width: 380px;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      font-family: 'Segoe UI', sans-serif;
    }

    .popup-box h2 {
      margin-top: 0;
      font-size: 1.5rem;
      color: #333;
      text-align: center;
      margin-bottom: 25px;
    }

    /* Grille des champs */
    .popup-content {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .input-row {
      display: flex;
      gap: 10px;
    }

    .input-field {
      flex: 1;
    }

    /* Style des Inputs & Select */
    .popup-content input,
    .popup-content select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      background: #fff;
      font-size: 0.95rem;
      color: #444;
      outline: none;
      transition: border-color 0.2s;
      box-sizing: border-box;
    }

    .popup-content input:focus {
      border-color: #2962FF;
    }

    /* Couleurs sp√©cifiques pour TP/SL */
    .tp input {
      border-left: 4px solid #00ffa3;
    }

    .sl input {
      border-left: 4px solid #ff3d60;
    }

    /* BOUTONS BLANCS AVEC DOUCE OMBRE */
    .popup-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
      gap: 15px;
    }

    .popup-buttons button {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      background: #ffffff;
      /* Couleur blanche demand√©e */
      color: #444;
      /* Douce ombre port√©e */
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
    }

    .popup-buttons button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);
      background: #fcfcfc;
    }

    #savePopupBtn {
      color: #2962FF;
      /* Texte bleu pour le bouton d'action */
      border: 1px solid #f0f0f0;
    }

    #closePopupBtn {
      color: #888;
    }

    /* Animation popup */
    @keyframes popupShow {
      from {
        opacity: 0;
        transform: scale(0.78);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    #controlPanelToggle {
      margin-top: 10px;
      padding: 8px 16px;
      border-radius: 8px;
      background: white;
      color: #4d4747;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    #controlPanelToggle:hover {
      background: white;
      transform: translateY(-2px);
    }

    #controlFormPanel {
      display: none;
      opacity: 0;
      transform: translateY(40px);
      transition: all 0.35s ease;
      flex-direction: column;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      padding: 20px;
      margin-top: 12px;
    }

    #controlFormPanel.active {
      opacity: 1;
      transform: translateY(0);
    }

    /* üìä Panneau des contrats ouverts */
    /* --- Conteneur des contrats --- */
    #contractsPanelContainer {
      background: #ffffff;
      border-radius: 16px;
      padding: 20px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    }

    #contractsPanelToggle {
      background: #f1f5f9;
      color: #475569;
      border: 1px solid #cbd5e1;
      padding: 10px 20px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    #contractsPanelToggle:hover {
      background: #e2e8f0;
    }

    /* --- Table Styles --- */
    .trade-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 8px;
      /* Espace entre les lignes */
      margin-top: 15px;
    }

    .trade-table th {
      color: #64748b;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 12px;
      border-bottom: 2px solid #f1f5f9;
    }

    .trade-table tbody tr {
      background: #ffffff;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .trade-table tbody tr:hover {
      transform: scale(1.005);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      z-index: 10;
    }

    .trade-table td {
      padding: 14px 12px;
      border-top: 1px solid #f1f5f9;
      border-bottom: 1px solid #f1f5f9;
      font-size: 0.9rem;
    }

    .trade-table td:first-child {
      border-left: 1px solid #f1f5f9;
      border-radius: 10px 0 0 10px;
    }

    .trade-table td:last-child {
      border-right: 1px solid #f1f5f9;
      border-radius: 0 10px 10px 0;
    }

    /* --- Badges & Profits --- */
    .badge-type {
      padding: 4px 8px;
      border-radius: 6px;
      font-weight: 700;
      font-size: 0.75rem;
    }

    .MULTUP {
      background: rgba(16, 185, 129, 0.1);
      color: #10b981;
    }

    .MULTDOWN {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }

    .profit-positive {
      color: #10b981;
      font-weight: 800;
      animation: pulse-green 2s infinite;
    }

    .profit-negative {
      color: #ef4444;
      font-weight: 800;
    }

    @keyframes pulse-green {
      0% {
        opacity: 1;
      }

      50% {
        opacity: 0.7;
      }

      100% {
        opacity: 1;
      }
    }

    /* Bouton delete global */
    #deleteSelected {
      background: #fee2e2 !important;
      color: #ef4444 !important;
      font-weight: 600;
      border: 1px solid #fecaca !important;
      padding: 8px 16px !important;
      transition: all 0.2s;
    }

    #deleteSelected:hover {
      background: #ef4444 !important;
      color: white !important;
    }

    /* --- ACCOUNT MANAGEMENT CONTAINER STYLES --- */
    #tradeEvaluationContainer {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 24px;
      font-family: 'Inter', system-ui, sans-serif;
      border: 1px solid var(--border);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.03);
    }

    /* --- TOGGLE BUTTON --- */
    #tradeEvalToggle {
      background: var(--bg-app);
      border: 1px solid var(--border);
      padding: 12px 20px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    #tradeEvalToggle:hover {
      background: #fff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    /* --- SUMMARY CARD --- */
    #tradeSummary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 24px;
      margin-top: 24px;
      padding: 24px;
      background: var(--bg-app);
      border-radius: 16px;
    }

    .trade-info label,
    .date-group label {
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--text-muted);
      text-transform: uppercase;
      margin-bottom: 8px;
      display: block;
    }

    #balanceValue,
    #accountHolder {
      font-size: 1.4rem;
      font-weight: 800;
      color: var(--text-main);
    }

    .account-actions {
      display: flex;
      gap: 8px;
    }

    #accountSelect,
    input[type="date"] {
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 0.9rem;
    }

    /* --- CIRCULAR CHARTS --- */
    #tradeCharts {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }

    .circle-chart {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      text-align: center;
      transition: transform 0.3s;
    }

    .circle-chart:hover {
      transform: translateY(-5px);
    }

    .chart-container {
      position: relative;
      width: 90px;
      height: 90px;
      margin: 0 auto 15px;
    }

    .circular-chart {
      display: block;
      margin: 0 auto;
    }

    .circle-bg {
      fill: none;
      stroke: #f1f5f9;
      stroke-width: 3;
    }

    .circle {
      fill: none;
      stroke-width: 3;
      stroke-linecap: round;
      transition: stroke-dasharray 0.8s ease;
    }

    .red .circle {
      stroke: var(--danger);
    }

    .blue .circle {
      stroke: var(--primary);
    }

    .mix .circle {
      stroke: var(--success);
    }

    .inner-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .inner-content span {
      font-size: 1.1rem;
      font-weight: 800;
    }

    #lossvalue {
      color: var(--danger);
      font-weight: 700;
    }

    #profitvalue {
      color: var(--primary);
      font-weight: 700;
    }

    #plvalue {
      color: var(--success);
      font-weight: 700;
    }

    /* --- REFRESH PROGRESS BAR --- */
    .action-group {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    #refreshProgressContainer {
      display: none;
      width: 80px;
      height: 4px;
      background: #e2e8f0;
      border-radius: 10px;
      overflow: hidden;
    }

    #refreshProgressBar {
      width: 0%;
      height: 100%;
      background: var(--primary);
      transition: width 0.3s ease;
    }

    #fetchTrades {
      background: var(--primary);
      color: #fff;
      border: none;
      padding: 10px 18px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
    }

    /* --- GRAPHICAL PLACEHOLDER --- */
    .section-title {
      font-size: 1rem;
      color: var(--text-muted);
      margin-top: 30px;
    }

    #HistoricalgraphicalContract {
      background: #f8fafc;
      border: 1px dashed var(--border);
      border-radius: 16px;
      min-height: 350px;
    }

    /* -- Foot Page --- */
    footer {
      width: 100%;
      background-color: #f8f9fa;
      /* gris fonc√© */
      color: gray;
      text-align: center;
      padding: 12px 0;
      font-size: 14px;
      position: relative;
      /* reste visible en bas de l‚Äô√©cran */
      bottom: 0;
      left: 0;
      z-index: 1000;
      /*box-shadow: 0 -2px 8px rgba(0,0,0,0.2);*/
    }

    /* Conteneur horizontal */
    #symbolList {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      padding: 12px;
      white-space: nowrap;

      background: rgba(255, 255, 255, 0.15);
      border-radius: 18px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);

      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);

      scrollbar-width: thin;
      scrollbar-color: rgba(255, 255, 255, 0.4) transparent;
    }

    /* Item individuel */
    .symbol-item {
      padding: 10px 18px;
      background: rgba(255, 255, 255, 0.12);
      border-radius: 14px;
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;
      color: #2e2a2a;
      border: 1px solid whitesmoke;
      transition: all 0.25s ease;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }

    /* Hover ‚Üí whitesmoke */
    .symbol-item:hover {
      background: whitesmoke;
      color: #000;
      transform: translateY(-2px);
    }

    /* S√©lection ‚Üí whitesmoke aussi */
    .symbol-item.selected {
      background: whitesmoke;
      color: #000;
      border: 1px solid rgba(255, 255, 255, 0.6);
      box-shadow: 0 0 12px rgba(255, 255, 255, 0.6);
    }

    .trade-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .trade-table thead th {
      position: sticky;
    }

    .trade-header h3 {
      color: rgb(25, 24, 24);
      margin: 0;
      padding-top: 10px;
    }

    .trade-header button {
      background-color: transparent;
      color: gray;
      background: white;
      border: 1px solid white;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    }

    .trade-header button:hover {
      background-color: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.12);
    }

    #HistoricalContract {
      margin-top: 5px;
      /* ou plus selon la hauteur des gauges */
      padding-bottom: 45px;
    }

    #tradeHistory {
      margin-top: 40px;
      padding-bottom: 30px;
      margin-bottom: 40px;
    }

    /* === Overlay === */
    /* --- Fen√™tre Modale --- */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(15, 23, 42, 0.4);
      /* Overlay sombre l√©ger */
      backdrop-filter: blur(4px);
      /* Effet de flou en arri√®re-plan */
    }

    .modal-content {
      background-color: #ffffff;
      margin: 10% auto;
      padding: 0;
      border-radius: 20px;
      width: 90%;
      max-width: 450px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      overflow: hidden;
      font-family: 'Inter', sans-serif;
    }

    /* Header de la modale */
    .modal-header {
      padding: 20px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #f1f5f9;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 700;
      color: #1e293b;
    }

    .close {
      font-size: 24px;
      color: #94a3b8;
      cursor: pointer;
      transition: color 0.2s;
    }

    .close:hover {
      color: #ef4444;
    }

    /* Corps de la modale */
    .modal-body {
      padding: 24px;
    }

    h4 {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #64748b;
      margin-bottom: 16px;
    }

    .divider {
      height: 1px;
      background: #f1f5f9;
      margin: 24px 0;
    }

    /* --- Boutons Styles (Chips) --- */
    .chart-type-section,
    .interval-section {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .chart-type-btn,
    .interval-btn {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      color: #475569;
      padding: 10px 16px;
      border-radius: 10px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .interval-btn {
      padding: 8px 12px;
      min-width: 55px;
      justify-content: center;
    }

    /* √âtats Active & Hover */
    .chart-type-btn:hover,
    .interval-btn:hover {
      background: #f1f5f9;
      border-color: #cbd5e1;
      transform: translateY(-1px);
    }

    .chart-type-btn.active,
    .interval-btn.active {
      background: #2563eb;
      border-color: #2563eb;
      color: #ffffff;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    /* Ic√¥nes discr√®tes */
    .icon {
      font-size: 1.1rem;
    }

    /* Titre */
    #forex-screener-section .widget-title {
      font-size: 17px;
      font-weight: 600;
      color: #333;
      border-bottom: 1px solid #f0f0f0;
      padding-bottom: 8px;
    }

    /* SECTION */
    #forex-screener-section {
      background: #ffffff;
      border-radius: 14px;
      padding-top: 20px;
      min-height: 770px !important;
      height: 850px !important;
      box-shadow: 0 4px 18px rgba(0, 0, 0, 0.08);
      border: 1px solid #e8e8e8;
      margin-top: 17px;
    }

    /* LE CONTENEUR DOIT PRENDRE LA HAUTEUR */
    #forex-screener-container {
      height: 700px !important;
      min-height: 550px !important;
      background: #fafafa;
      border-radius: 10px;
      border: 1px solid #efefef;
      overflow: hidden;
      margin-top: 20px;
      margin-left: 25px;
      margin-right: 10px;
    }


    /* SYMBOL INFO */
    #gold-info-section {
      background: #ffffff;
      border-radius: 14px;
      padding-top: 3px;
      box-shadow: 0 4px 18px rgba(0, 0, 0, 0.08);
      border: 1px solid #e8e8e8;
      margin-top: 5px;
    }

    #gold-info-container {
      background: #fafafa;
      border-radius: 10px;
      border: 1px solid #efefef;
      overflow: hidden;
      margin-top: 7px;
    }

    /*---------------------------------------------*/

    #accountSelect option {
      border-radius: 8px;
      border: 1px solid #e1dddd;
      background: #fafafa;
      color: #212325;
      font-size: 14px;
      cursor: pointer;
    }

    #panel h1 {
      width: 100%;
      text-align: left;
      font-size: 17px;
      color: #222;
      margin-bottom: 12px;
    }

    /* =====================================================   
   POPUP OVERLAY GLASS
===================================================== */
    .cashier-overlay,
    .webview-popup {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(12px);
      z-index: 9999;
    }

    .cashier-overlay.active,
    .webview-popup.active {
      display: flex;
    }

    /* =====================================================
   CASHIER PANEL
===================================================== */
    .cashier-panel {
      width: 380px;
      max-width: 90%;
      background: #ffffff;
      border-radius: 18px;
      padding: 28px 26px;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.12);
      position: relative;
      animation: slideIn 0.35s ease-out;
      display: flex;
      flex-direction: column;
    }

    .cashier-panel h2 {
      text-align: center;
      margin-bottom: 18px;
      font-size: 1.45rem;
      font-weight: 700;
      color: #1a1a1a;
    }

    /* Labels */
    .cashier-panel label {
      margin-top: 14px;
      font-size: 0.88rem;
      font-weight: 600;
      color: #333;
    }

    /* Inputs + Selects */
    .cashier-panel input,
    .cashier-panel select {
      width: 100%;
      padding: 10px 12px;
      margin-top: 6px;
      border-radius: 10px;
      border: 1px solid #d0d0d0;
      background: #fafafa;
      font-size: 0.95rem;
      transition: border 0.2s, box-shadow 0.2s;
    }

    .cashier-panel input:focus,
    .cashier-panel select:focus {
      border-color: #2563eb;
      box-shadow: 0 0 6px rgba(37, 99, 235, 0.35);
      background: #fff;
    }

    /* Error box */
    #errorBox {
      margin-top: 12px;
      padding: 10px;
      background: #fee2e2;
      border: 1px solid #fca5a5;
      border-radius: 8px;
      color: #b91c1c;
      font-size: 0.85rem;
      display: none;
    }

    /* =====================================================
   BUTTONS
===================================================== */
    .cashier-panel button {
      width: 100%;
      padding: 12px;
      margin-top: 16px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.25s, transform 0.1s;
    }

    .cashier-panel button:active {
      transform: scale(0.97);
    }

    /* Primary buttons */
    #sendEmailBtn {
      background: #2563eb;
      color: white;
    }

    #sendEmailBtn:hover {
      background: #1e40af;
    }

    #validateCodeBtn {
      background: #10b981;
      color: white;
    }

    #validateCodeBtn:hover {
      background: #059669;
    }

    /* Close */
    #closeCashierBtn {
      background: #ef4444;
      color: white;
    }

    #closeCashierBtn:hover {
      background: #b91c1c;
    }

    /* =====================================================
   WEBVIEW POPUP
===================================================== */
    .webview-box {
      width: 85%;
      max-width: 900px;
      height: 85%;
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.12);
      display: flex;
      flex-direction: column;
      animation: slideIn 0.35s ease-out;
    }

    .webview-header {
      padding: 14px 20px;
      font-size: 1.05rem;
      font-weight: 700;
      color: #1a1a1a;
      border-bottom: 1px solid #e5e5e5;
    }

    .webview-box iframe {
      flex: 1;
      border: none;
      background: #f5f5f5;
    }

    /* Close webview button */
    .webview-box .close-btn {
      padding: 14px;
      background: #ef4444;
      border: none;
      color: white;
      cursor: pointer;
      font-weight: 600;
      transition: 0.25s;
    }

    .webview-box .close-btn:hover {
      background: #b91c1c;
    }

    /* =====================================================
   ANIMATIONS
===================================================== */
    @keyframes slideIn {
      0% {
        transform: translateY(-40px);
        opacity: 0;
      }

      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }

    /* =====================================================
   RESPONSIVE (Mobile)
===================================================== */
    @media (max-width: 600px) {
      .cashier-panel {
        width: 92%;
        padding: 20px;
      }

      .webview-box {
        width: 96%;
        height: 92%;
      }
    }

    /* Centrage horizontal uniquement des champs */
    .cashier-panel input {
      align-self: center;
      /* Centre l'√©l√©ment dans le flex-column */
      width: 93%;
      /* Garde le style mais r√©duit l√©g√®rement la largeur */
    }

    .cashier-panel select {
      align-self: center;
      /* Centre l'√©l√©ment dans le flex-column */
      width: 100%;
      /* Garde le style mais r√©duit l√©g√®rement la largeur */
    }

    .cashier-panel button {
      align-self: center;
      /* Centre l'√©l√©ment dans le flex-column */
      width: 100%;
      /* Garde le style mais r√©duit l√©g√®rement la largeur */
    }

    #overlayML {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    #countdown {
      font-size: 100px;
      font-weight: bold;
      color: #ffffff;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        opacity: 1;
      }

      50% {
        transform: scale(1.2);
        opacity: 0.7;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* ================= TRADE HISTORY STYLES ================= */

    #tradeHistoryContainer__ {
      background: var(--bg-main);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid var(--border-color);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      max-width: 100%;
    }

    /* Header */
    .header-flex {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }

    .tradeHistoryTitle__ {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-dark);
      margin: 0;
      display: flex;
      align-items: center;
    }

    #tradeHistoryStatus__ {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--brand-blue);
      background: rgba(72, 52, 212, 0.08);
      padding: 5px 12px;
      border-radius: 20px;
    }

    /* Tableau */
    .tradeHistoryTableWrapper__ {
      width: 100%;
      overflow-x: auto;
    }

    #tradeHistoryTable__ {
      width: 100%;
      border-collapse: collapse;
      text-align: left;
    }

    #tradeHistoryTable__ th {
      padding: 12px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-gray);
      border-bottom: 2px solid var(--bg-sub);
      background: var(--bg-sub);
    }

    #tradeHistoryTable__ td {
      padding: 14px 12px;
      border-bottom: 1px solid var(--border-color);
      font-size: 0.9rem;
      color: var(--text-dark);
      vertical-align: middle;
    }

    /* Animation d'entr√©e des nouveaux signaux */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
        background: #f0f3ff;
      }

      to {
        opacity: 1;
        transform: translateY(0);
        background: transparent;
      }
    }

    .new-signal-row {
      animation: slideIn 0.5s ease-out forwards;
    }

    /* Badges Signal */
    .signal-badge-buy-light {
      background: rgba(0, 184, 148, 0.12);
      color: var(--success-green);
      padding: 4px 10px;
      border-radius: 6px;
      font-weight: 700;
      font-size: 0.75rem;
      border: 1px solid rgba(0, 184, 148, 0.2);
    }

    .signal-badge-sell-light {
      background: rgba(214, 48, 49, 0.1);
      color: var(--danger-red);
      padding: 4px 10px;
      border-radius: 6px;
      font-weight: 700;
      font-size: 0.75rem;
      border: 1px solid rgba(214, 48, 49, 0.2);
    }

    /* Indicateur de Probabilit√© */
    .prob-container-light {
      display: flex;
      flex-direction: column;
      gap: 5px;
      min-width: 90px;
    }

    .prob-bar-bg-light {
      width: 100%;
      height: 4px;
      background: #eee;
      border-radius: 2px;
      overflow: hidden;
    }

    .prob-bar-fill-light {
      height: 100%;
      transition: width 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    /* Polices Sp√©cifiques */
    .time-dim-light {
      color: var(--text-light);
      font-size: 0.8rem;
      font-family: 'JetBrains Mono', monospace;
    }

    .price-mono-light {
      font-family: 'JetBrains Mono', monospace;
      color: var(--brand-blue);
      font-weight: 600;
    }

    .symbol-light {
      font-weight: 700;
      color: var(--text-dark);
    }

    /* Live Pulse Icon */
    .live-pulse {
      width: 8px;
      height: 8px;
      background: var(--success-green);
      border-radius: 50%;
      margin-left: 10px;
      display: inline-block;
      box-shadow: 0 0 8px var(--success-green);
      animation: pulse-ring 2s infinite;
    }

    @keyframes pulse-ring {
      0% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(0, 184, 148, 0.7);
      }

      70% {
        transform: scale(1);
        box-shadow: 0 0 0 6px rgba(0, 184, 148, 0);
      }

      100% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(0, 184, 148, 0);
      }
    }

    .open-btn {
      padding: 10px 15px;
      background: #2962FF;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      border-radius: 4px;
    }

    /* Fond de l'overlay (assombrissement de l'arri√®re-plan) */
    .overlay_ {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      /* Noir transparent doux */
      backdrop-filter: blur(4px);
      /* Effet de flou derri√®re la popup */
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .hidden {
      display: none !important;
    }

    /* La Popup */
    .popup {
      background: #ffffff;
      width: 90%;
      max-width: 350px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      animation: fadeIn 0.3s ease-out;
    }

    /* En-t√™te de la popup */
    .popup-header {
      padding: 15px 20px;
      background: #f8f9fa;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #333;
      font-weight: 600;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 18px;
      color: #999;
      cursor: pointer;
      transition: color 0.2s;
    }

    .close-btn:hover {
      color: #ff4d4d;
    }

    /* Corps de la popup */
    .popup-body {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    /* Style des boutons (Fond blanc, ombre douce) */
    .popup-body button {
      width: 100%;
      padding: 12px;
      background: #ffffff;
      border: 1px solid #f0f0f0;
      border-radius: 10px;
      color: #444;
      font-weight: 500;
      cursor: pointer;
      text-align: left;
      transition: all 0.2s ease;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
      /* Ombre tr√®s l√©g√®re */
    }

    /* Effet au survol */
    .popup-body button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      border-color: #d1d4dc;
    }

    /* --- √âtats Actifs (G√©r√©s par vos classes existantes) --- */
    .popup-body button.active-20 {
      background: #2962FF !important;
      color: white;
      border-color: #2962FF;
    }

    .popup-body button.active-50 {
      background: #9c27b0 !important;
      color: white;
      border-color: #9c27b0;
    }

    .popup-body button.active-200 {
      background: #ff9800 !important;
      color: white;
      border-color: #ff9800;
    }

    .popup-body button.active {
      background: #88ff00 !important;
      color: rgb(71, 68, 68);
      border-color: #88ff00;
    }

    /* Style pour les boutons d'objets (Trendline, etc.) */
    .popup-body button:not([id]) {
      background: #fdfdfd;
      color: #555;
      border-left: 4px solid #eee;
      /* Petite barre d√©corative √† gauche */
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes pulse-red {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(255, 61, 96, 0.7);
      }

      70% {
        transform: scale(1.05);
        box-shadow: 0 0 0 10px rgba(255, 61, 96, 0);
      }

      100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(255, 61, 96, 0);
      }
    }

    /* Animation de succ√®s pour le bouton */
    .btn-success-flash {
      animation: flash-green 0.6s ease-out;
    }

    @keyframes flash-green {
      0% {
        background-color: #00ffa3;
        box-shadow: 0 0 20px #00ffa3;
        transform: scale(1.05);
      }

      100% {
        background-color: transparent;
        /* Ou votre couleur de bouton initiale */
        box-shadow: 0 0 0px transparent;
        transform: scale(1);
      }
    }

    /* Animation de flash rouge pour les pertes */
    .btn-danger-flash {
      animation: flash-red 0.6s ease-out;
    }

    @keyframes flash-red {
      0% {
        background-color: #ff3d60;
        box-shadow: 0 0 20px #ff3d60;
        transform: scale(1.05);
      }

      100% {
        background-color: transparent;
        box-shadow: 0 0 0px transparent;
        transform: scale(1);
      }
    }
  </style>
</head>

<body>
  <header>
    <div id="symbolList"></div>
    <div id="controls">
      <button id="connectBtn">Connect</button>
    </div>
  </header>

  <section class="widget-section full-width" id="gold-info-section">
    <div id="gold-info-container" class="tradingview-widget-container"></div>
  </section>

  <!-- Panneau complet de contr√¥le sous le chart -->
  <div id="controlFormPanel">
    <div>
      <!-- Left buttons -->
      <div style="display:flex; gap:12px; flex-wrap:wrap;">
        <button class="open-btn" id="START">Start Automation</button>
        <button id="STOP">Stop Automation</button>
        <button id="openPopupBtn__" class="open-btn">Indicators</button>
        <button id="openCashierBtn">Cashier</button>
        <button id="buyBtn">BUY</button>
        <button id="sellBtn">SELL</button>
        <button id="reverseBtn">Reverse Position</button>
        <button id="closeWinning">Close Winning</button>
        <button id="closeLosing">Close Losing</button>
        <button id="closeAll">Close All</button>
        <button id="openPopup">Chart Types</button>
        <button id="DatasettingPopup">Trade setting</button>
        <div id="accountInfo" style="margin-left:200px; font-weight:500; color:#333;"></div>
      </div>
    </div>
  </div>

  <div id="overlayML">
    <div id="countdown">5</div>
  </div>

  <!-- Bouton pour afficher / cacher le panneau -->
  <button id="controlPanelToggle">‚öôÔ∏è Show Controls</button>

  <div id="settingsPopup" class="popup-overlay">
    <div class="popup-box">
      <h2>Trade Settings</h2>
      <div class="popup-content">
        <div class="input-field">
          <select id="multiplierSelect">
            <option value="" disabled selected>Multiplier</option>
            <option value="40">40</option>
            <option value="50">50</option>
            <option value="100">100</option>
            <option value="150">150</option>
            <option value="200">200</option>
            <option value="250">250</option>
            <option value="300">300</option>
            <option value="400">400</option>
            <option value="500">500</option>
            <option value="1200">1200</option>
            <option value="3000">3000</option>
          </select>
        </div>

        <div class="input-field">
          <input type="number" id="stakeInput" min="1" placeholder="Stake Amount">
        </div>

        <div class="input-row">
          <div class="input-field">
            <input type="number" id="buyNumberInput" min="1" placeholder="Buy Count">
          </div>
          <div class="input-field">
            <input type="number" id="sellNumberInput" min="1" placeholder="Sell Count">
          </div>
        </div>

        <div class="input-row">
          <div class="input-field tp">
            <input type="number" id="tpInput" min="0" placeholder="Take Profit">
          </div>
          <div class="input-field sl">
            <input type="number" id="slInput" min="0" placeholder="Stop Loss">
          </div>
        </div>
      </div>

      <div class="popup-buttons">
        <button id="closePopupBtn">Close</button>
        <button id="savePopupBtn">Save Settings</button>
      </div>
    </div>
  </div>

  <!-- TradingView Widget BEGIN -->
  <div id="ticker-container" class="tradingview-widget-container"></div>
  <!-- TradingView Widget END -->

  <div id="container__">
    <div id="chartArea">

      <div id="pnl-container">
        <span class="pnl-label">PnL Global:</span>
        <span id="total-pnl">0.00</span>
        <span id="pnl-arrow"></span>
        <span class="pnl-currency">$</span>
      </div>

      <div id="chartInner"></div>

    </div>
  </div>

  <div id="tradeHistoryContainer__" class="glass-panel">
    <div class="header-flex">
      <h2 class="tradeHistoryTitle__">AI-TCN Engine <span class="live-pulse"></span></h2>
      <div id="tradeHistoryStatus__">Standby</div>
    </div>

    <div class="tradeHistoryTableWrapper__">
      <table id="tradeHistoryTable__">
        <thead>
          <tr id="tradeHistoryHeaderRow__">
            <th class="th-tick-time">Time</th>
            <th class="th-symbol">Asset</th>
            <th class="th-signal">Signal</th>
            <th class="th-price">Entry Price</th>
            <th class="th-prob">Confidence</th>
          </tr>
        </thead>
        <tbody id="tradeHistoryBody__">
        </tbody>
      </table>
    </div>
  </div>

  <!-- OVERLAY -->
  <div id="indicatorOverlay" class="overlay_ hidden">
    <div class="popup">
      <div class="popup-header">
        <span>Indicateurs & Objets</span>
        <button class="close-btn" onclick="closePopup()">‚úñ</button>
      </div>

      <div class="popup-body">
        <!-- Indicateurs -->
        <button id="ma20" onclick="toggleMA(20, this)">MA 20 : OFF</button>
        <button id="ma50" onclick="toggleMA(50, this)">MA 50 : OFF</button>
        <button id="ma200" onclick="toggleMA(200, this)">MA 200 : OFF</button>
        <button id="ZigZag" onclick="toggleZigZag(this)">ZigZag 14 : OFF</button>

        <!-- Objets graphiques -->
        <button onclick="enableTrendline(this)">Trendline</button>
        <button onclick="enableRectangle(this)">Rectangle</button>
        <button onclick="enableTPSL(this)">TP / SL</button>
      </div>
    </div>
  </div>

  <!-- === Popup de s√©lection === -->
  <div id="chartTypeModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Chart Settings</h3>
        <span class="close" id="closeModal">&times;</span>
      </div>

      <div class="modal-body">
        <section>
          <h4>Chart Style</h4>
          <div class="chart-type-section">
            <button class="chart-type-btn" data-type="line">
              <span class="icon">üìà</span> Line
            </button>
            <button class="chart-type-btn" data-type="area">
              <span class="icon">üìä</span> Area
            </button>
            <button class="chart-type-btn active" data-type="candlestick">
              <span class="icon">üïØÔ∏è</span> Candlestick
            </button>
          </div>
        </section>

        <div class="divider"></div>

        <section>
          <h4>Time Interval</h4>
          <div class="interval-section">
            <button class="interval-btn" data-interval="1t">1t</button>
            <button class="interval-btn active" data-interval="1m">1m</button>
            <button class="interval-btn" data-interval="2m">2m</button>
            <button class="interval-btn" data-interval="3m">3m</button>
            <button class="interval-btn" data-interval="5m">5m</button>
            <button class="interval-btn" data-interval="10m">10m</button>
            <button class="interval-btn" data-interval="15m">15m</button>
            <button class="interval-btn" data-interval="30m">30m</button>
            <button class="interval-btn" data-interval="1h">1h</button>
            <button class="interval-btn" data-interval="2h">2h</button>
            <button class="interval-btn" data-interval="4h">4h</button>
            <button class="interval-btn" data-interval="8h">8h</button>
            <button class="interval-btn" data-interval="1d">1d</button>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- Nouveau panneau des Trades -->
  <div id="tradeEvaluationContainer">
    <button id="tradeEvalToggle">‚öôÔ∏è Account Management</button>

    <div id="tradeEvalPanel">
      <div id="tradeSummary">
        <div class="trade-info">
          <label>Balance</label>
          <span id="balanceValue">-</span>
        </div>
        <div class="trade-info">
          <label>Account Holder</label>
          <span id="accountHolder">-</span>
        </div>
        <div class="trade-info">
          <label>Accounts</label>
          <div class="account-actions">
            <select id="accountSelect">
              <option value="">Select Account Type</option>
            </select>
            <button id="deleteSelectedAccount" title="Supprimer">üóëÔ∏è</button>
          </div>
        </div>

        <div class="trade-dates">
          <div class="date-group">
            <label>Start Date</label>
            <input type="date" id="startDate" value="2025-10-01">
          </div>
          <div class="date-group">
            <label>End Date</label>
            <input type="date" id="endDate" value="2025-10-31">
          </div>
        </div>
      </div>

      <div id="tradeCharts">
        <div class="circle-chart red">
          <div class="chart-container">
            <svg viewBox="0 0 36 36" class="circular-chart">
              <path class="circle-bg"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
              <path id="circle-loss-path" class="circle" stroke-dasharray="0, 100"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
            </svg>
            <div class="inner-content"><span id="loss">0%</span></div>
          </div>
          <label>Loss: <span id="lossvalue">0 <span id="losscurrency">USD</span></span></label>
        </div>

        <div class="circle-chart blue">
          <div class="chart-container">
            <svg viewBox="0 0 36 36" class="circular-chart">
              <path class="circle-bg"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
              <path id="circle-profit-path" class="circle" stroke-dasharray="0, 100"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
            </svg>
            <div class="inner-content"><span id="profit">0%</span></div>
          </div>
          <label>Profit: <span id="profitvalue">0 <span id="profitcurrency">USD</span></span></label>
        </div>

        <div class="circle-chart mix">
          <div class="chart-container">
            <svg viewBox="0 0 36 36" class="circular-chart">
              <path class="circle-bg"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
              <path id="circle-pl-path" class="circle" stroke-dasharray="0, 100"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
            </svg>
            <div class="inner-content"><span id="pl">0%</span></div>
          </div>
          <label>P/L: <span id="plvalue">0 <span id="plcurrency">USD</span></span></label>
        </div>
      </div>

      <h3 class="section-title">Contrats Representation</h3>
      <div id="HistoricalgraphicalContract"></div>

      <p id="message"></p>

      <div id="tradeHistory">
        <div class="trade-header">
          <h3>Trade History</h3>
          <div class="action-group">
            <div id="refreshProgressContainer">
              <div id="refreshProgressBar"></div>
            </div>
            <button id="fetchTrades">Refresh Table</button>
          </div>
        </div>
        <div id="HistoricalContract"></div>
      </div>
    </div>
  </div>

  <!-- Nouveau panneau des contrats ouverts -->
  <div id="contractsPanelContainer">
    <button id="contractsPanelToggle">üìÑ Show Contracts</button>
    <div id="contractsPanel">
      <div id="autoHistoryList"></div>
    </div>
  </div>

  <!-- Nouveau panneau des Calendriers economiques -->
  <div class="container">
    <div class="panel" id="panel">
      <h1>Economic calendar</h1>
      <div class="toolbar">
        <label class="muted small">Token Deriv:</label>
        <input type="text" id="tokencalendar" placeholder="Enter your token..." style="min-width:200px" />

        <label class="muted small">Devise:</label>
        <select id="currency">
          <option value="USD">USD</option>
          <option value="CNH">CNY</option>
          <option value="EUR">EUR</option>
          <option value="JPY">JPY</option>
          <option value="GBP">GBP</option>
          <option value="AUD">AUD</option>
          <option value="CAD">CAD</option>
          <option value="MXN">MXN</option>
          <option value="CHF">CHF</option>
        </select>

        <label class="muted small">Start:</label>
        <input type="date" id="startDate" />
        <label class="muted small">End:</label>
        <input type="date" id="endDate" />

        <label class="muted small">Filter:</label>
        <input type="text" id="search" placeholder="Search your keywords" />
        <select id="impactFilter">
          <option value="">Impact: All</option>
          <option value="High">High</option>
          <option value="Medium">Medium</option>
          <option value="Low">Low</option>
        </select>
        <button id="fetchCalendar">üìÖ Load</button>
        <button id="refresh">üîÅ Refresh</button>
        <div style="flex:1"></div>
        <span id="status" class="muted small">statut: ready</span>
      </div>

      <div class="table-wrap">
        <div id="CalendarList"></div>
      </div>

    </div>
  </div>

  <section class="widget-section full-width" id="forex-screener-section">
    <div class="widget-title">Forex Screener</div>
    <div id="forex-screener-container" class="tradingview-widget-container"></div>
  </section>

  <!-- =======================
     POPUP CASHIER (Glass)
     ======================= -->
  <div class="cashier-overlay" id="cashierModal">

    <div class="cashier-panel">
      <h2>Deriv Cashier</h2>

      <label>Email Deriv</label>
      <input id="emailInput" placeholder="entrer votre email" />

      <button id="sendEmailBtn">Envoyer email de v√©rification</button>

      <label>Type d'op√©ration</label>
      <select id="actionSelect">
        <option value="deposit">D√©p√¥t</option>
        <option value="withdrawal">Retrait</option>
      </select>

      <label>Provider</label>
      <select id="providerSelect">
        <option value="cashier">cashier</option>
        <option value="doughflow">doughflow</option>
        <option value="crypto">crypto (USDT / BTC / ...)</option>
      </select>

      <label>Devise (optionnel)</label>
      <input id="currencySelect" placeholder="USD, USDT..." />

      <label>Code re√ßu par email</label>
      <input id="codeInput" placeholder="123456" />

      <button id="validateCodeBtn">G√©n√©rer l'URL</button>

      <div id="errorBox"></div>

      <button id="closeCashierBtn" class="close-popup-btn">Fermer</button>
    </div>
  </div>

  <!-- =======================
     POPUP WEBVIEW
     ======================= -->
  <div class="webview-popup" id="webviewModal">
    <div class="webview-box">
      <div class="webview-header">Op√©ration Deriv</div>

      <iframe id="webviewFrame"></iframe>

      <button id="closeWebview" class="close-btn">Fermer</button>
    </div>
  </div>

  <script>

    function closePopup() {
      const overlay = document.getElementById('indicatorOverlay');
      if (overlay) {
        overlay.classList.add('hidden');
      }
    }

    // TRADINGVIEW WIDGET
    function createTradingViewEmbed(containerId, src, config, creditHtml) {
      const container = document.getElementById(containerId);
      if (!container) return;

      const placeholder = document.createElement('div');
      placeholder.className = 'tradingview-widget-container__widget';
      container.appendChild(placeholder);

      const s = document.createElement('script');
      s.type = 'text/javascript';
      s.async = true;
      s.src = src;
      s.text = JSON.stringify(config);
      container.appendChild(s);

      if (creditHtml) {
        const cr = document.createElement('div');
        cr.className = 'tradingview-widget-copyright';
        cr.innerHTML = creditHtml;
        container.appendChild(cr);
      }
    }

    // --- 1) Ticker Tape ---
    createTradingViewEmbed('ticker-container',
      'https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js',
      {
        "symbols": [
          { "proName": "FX:GBPUSD", "title": "S&P 500 Index" },
          { "proName": "OANDA:XAUUSD", "title": "Gold to USD" },
          { "proName": "FX_IDC:EURUSD", "title": "EUR to USD" },
          { "proName": "BITSTAMP:BTCUSD", "title": "Bitcoin" },
          { "proName": "BITSTAMP:ETHUSD", "title": "Ethereum" }
        ],
        "colorTheme": "light",
        "locale": "en",
        "isTransparent": false,
        "showSymbolLogo": true,
        "displayMode": "adaptive"
      }
    );

    createTradingViewEmbed(
      'gold-info-container',
      'https://s3.tradingview.com/external-embedding/embed-widget-symbol-info.js',
      {
        "symbol": "OANDA:XAUUSD",
        "colorTheme": "light",
        "isTransparent": false,
        "locale": "en",
        "width": "100%"
      }
    );

    // --- 4) Forex Screener ---
    createTradingViewEmbed('forex-screener-container',
      'https://s3.tradingview.com/external-embedding/embed-widget-screener.js',
      {
        "market": "forex",
        "showToolbar": true,
        "defaultColumn": "overview",
        "defaultScreen": "general",
        "isTransparent": false,
        "locale": "en",
        "colorTheme": "light",
        "width": "100%",
        "height": "100%"
      },
      '<a href="https://www.tradingview.com/markets/currencies/" target="_blank">Forex Screener</a>'
    );

    // Toggle panel
    const controlPanelToggle = document.getElementById("controlPanelToggle");
    const controlFormPanel = document.getElementById("controlFormPanel");
    controlPanelToggle.addEventListener("click", () => {
      if (controlFormPanel.style.display === "none" || controlFormPanel.style.display === "") {
        controlFormPanel.style.display = "flex";
        controlPanelToggle.textContent = "‚öôÔ∏è Hide Controls";
      } else {
        controlFormPanel.style.display = "none";
        controlPanelToggle.textContent = "‚öôÔ∏è Show Controls";
      }
    });

    const openPopup = document.getElementById("openPopup");
    const modal = document.getElementById("chartTypeModal");
    const closeModal = document.getElementById("closeModal");

    // Ouvrir le popup
    openPopup.addEventListener("click", () => {
      modal.style.display = "flex";
    });

    // Fermer le popup
    closeModal.addEventListener("click", () => {
      modal.style.display = "none";
    });

    // Fermer en cliquant √† l‚Äôext√©rieur
    modal.addEventListener("click", (e) => {
      if (e.target === modal) {
        modal.style.display = "none";
      }
    });

    // S√©lection du type de graphique
    document.querySelectorAll(".chart-type-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".chart-type-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
      });
    });

    // S√©lection de l‚Äôintervalle
    document.querySelectorAll(".interval-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".interval-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
      });
    });

  </script>
</body>
<footer>
  <p>¬© 2025 World Unicorn ‚Äî All rights reserved </p>
</footer>

</html>